<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>3RDEYESYSTEM Technical Documentations</title>
        <description>써드아이시스템(3rdeyesys) 기술문서 사이트입니다 - Ncloud 프리미엄 파트너</description>
        <link>https://docs.3rdeyesys.com/</link>
        <atom:link href="https://docs.3rdeyesys.com/feed.xml" rel="self" type="application/rss+xml"/>
        <pubDate>Mon, 06 Nov 2023 17:39:22 +0900</pubDate>
        <lastBuildDate>Mon, 06 Nov 2023 17:39:22 +0900</lastBuildDate>
        <generator>Jekyll v4.2.2</generator>
        
        
        <item>
            <title>Object Storage 접속용 Windows Client Tool - S3 Browser</title>
            <description>## 개요
네이버 클라우드의 Object Storage에 접속, 관리하는 방법은 aws cli 등 여러가지 있지만 Windows PC에서 간편하게 접속해서 관리할 수 있는 클라이언트 툴이 몇개 있습니다.  
그 중에서 이번에는 S3 Browser의 사용법에 대해 간단히 정리해보겠습니다.

## S3 Browser
S3 Browser는 Amazon S3 and Amazon CloudFront를 위한 클라이언트입니다
이 버전은 무료버전이기는 하지만, 정확히는 **personal use only**, **non-commecial use only**라고 명시되어 있습니다.  
그래서 라이선스와 관계없이 사용 가능하고, 더 많은 기능이 포함된 유료 버전도 있습니다. 

상세한 정보와 다운로드는 아래 링크에서 확인하시면 됩니다.

&lt;a href=&quot;https://s3browser.com/&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://s3browser.com/&lt;/a&gt;


## 사용법

프로그램을 다운 받아서 설치하고, 실행을 하면 여러 종류의 스토리지 중에서 원하는 것을 선택하게 됩니다.  
이 클라이언트는 AWS S3를 위한 것으로 CloudBerry Explorer와는 다르게 AWS의 다양한 S3 서비스들만 접속이 가능한데, 이용 가능한 스토리지 리스트는 마지막에서 정리해보겠습니다. 

{% include image.html file=&quot;storage/ncp_storage_object_storage_s3_client_s3browser_01.jpg&quot; width=&quot;850&quot; alt=&quot;Ncloud Object Storage 접속용 Windows Client Tool - S3 Browser 사용 방법&quot; caption=&quot;&quot; %}


Account Type은  **S3 Compatible Storage**를 선택하면 됩니다.  
- Account name: 여기는 알아보기 쉬운 이름을 적으면 됩니다. 예를 들어 Naver Cloud
- REST Endpoint: 여기는 네이버 클라우드의 endpoint-url을 적습니다. **kr.object.ncloudstorage.com**
- Access Key ID: 여기는 Access Key ID
- Secret Access Key: 여기는 Secret Key

{% include image.html file=&quot;storage/ncp_storage_object_storage_s3_client_s3browser_02.jpg&quot; width=&quot;718&quot; alt=&quot;Ncloud Object Storage 접속용 Windows Client Tool - S3 Browser 사용 방법&quot; caption=&quot;&quot; %}

{% include callout_v2.html type=&quot;success&quot; level=&quot;1&quot; content=&quot;네이버 클라우드 포탈 -&gt; 마이페이지 -&gt; 계정관리 -&gt; 인증키 관리 - API 인증키 관리 메뉴에서 Access Key ID와 Secret Key를 가져오셔야 하며, 아직 만들어진 Key가 없다면 새로 만드셔야 합니다.&quot; %}


계정 정보를 입력하고 접속을 하면 버킷 리스트가 나타나고 원하는 버킷을 선택해서 들어가면 다음처럼 파일들을 확인할 수 있습니다.

{% include image.html file=&quot;storage/ncp_storage_object_storage_s3_client_s3browser_03.jpg&quot; width=&quot;850&quot; alt=&quot;Ncloud Object Storage 접속용 Windows Client Tool - S3 Browser 사용 방법&quot; caption=&quot;&quot; %}


Object Storage에 있는 파일을 로컬PC로 가져오려면 원하는 파일을 선택하고 마우스 오른쪽 버튼을 눌러서 **Download** 명령을 선택하면 됩니다.

{% include image.html file=&quot;storage/ncp_storage_object_storage_s3_client_s3browser_04.jpg&quot; width=&quot;850&quot; alt=&quot;Ncloud Object Storage 접속용 Windows Client Tool - S3 Browser 사용 방법&quot; caption=&quot;&quot; %}


그 외 여러 가지 기능들이 있는데 그리 어려운 기능은 아니므로 직접 사용해보시면 금방 알 수 있습니다.

마지막으로 S3 Browser로 접속 가능한 S3 리스트를 확인해보겠습니다.

{% include image.html file=&quot;storage/ncp_storage_object_storage_s3_client_s3browser_05.jpg&quot; width=&quot;717&quot; alt=&quot;Ncloud Object Storage 접속용 Windows Client Tool - S3 Browser 사용 방법&quot; caption=&quot;&quot; %}

- Amazon S3 Storage
- S3 Compatible Storage
- Amazon S3 in China
- Amazon S3 GovCloud Storage
- Amazon S3 GovCloud Storage (FIPS 140-2)
- Amazon S3 via EC2 IAM Role
- Amazon S3 via AssumeRole
- Amazon S3 (Credentials from Environment Variables)
- Amazon S3 (Credentials from AWS Config or Credential file)


## 업로드하는 파일 권한 자동 적용
S3 Browser를 이용해 파일을 업로드할 때 업로드하는 파일의 권한을 자동으로 적용하는 방법에 대해 살펴보겠습니다.

우선 S3 Browser에서 [**Tools**] - [**Option**] 메뉴를 클릭합니다.

{% include image.html file=&quot;storage/ncp_storage_object_storage_s3_client_s3browser_06.png&quot; width=&quot;845&quot; alt=&quot;Ncloud Object Storage 접속용 Windows Client Tool - S3 Browser 사용 방법&quot; caption=&quot;&quot; %}

- [**Option**] 메뉴에 보면 여러 옵션들이 있는데 아래 스샷에서 표시한 2가지 옵션이 중요합니다. 각각에 대한 설명은 아래쪽에서 다시 정리해보겠습니다.
{% include image.html file=&quot;storage/ncp_storage_object_storage_s3_client_s3browser_07.png&quot; width=&quot;845&quot; alt=&quot;Ncloud Object Storage 접속용 Windows Client Tool - S3 Browser 사용 방법&quot; caption=&quot;&quot; %}

### 버킷(Bucket) 권한 상속
[**Inherit permissions from parent bucket**] 옵션은 버킷(Bucket)에 업로드 되는 파일들은 버킷(Bucket)의 권한을 상속 받게 하는 옵션입니다.  
예를 들어 버킷(Bucket)의 권한이 [**All User**]에게 [**Read**] 권한이라면 이 옵션을 선택해두면 이 버킷(Bucket)에 업로드 되는 모든 파일은 [**All User**]에게 [**Read**] 권한을 가지게 됩니다.

### 권한 유지
[**Preserve permissions when overwriting existing files**] 옵션은 이미 버킷(Bucket)에 존재하는 파일을 다시 업로드 해서 덮어 쓰기를 할 경우 기존의 권한을 유지하도록 하는 옵션입니다.


## 참고 URL
1.  S3 Browser 홈페이지
	- &lt;a href=&quot;https://s3browser.com/&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://s3browser.com/&lt;/a&gt;

2.  S3 Browser S3-Compatible Storages 설정 가이드
	- &lt;a href=&quot;https://s3browser.com/s3-compatible-storage.aspx&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://s3browser.com/s3-compatible-storage.aspx&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}</description>
            <pubDate>Mon, 06 Nov 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/storage/ncloud_storage_object_storage_s3_client_s3browser.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/storage/ncloud_storage_object_storage_s3_client_s3browser.html</guid>
            
            <category>object_storage</category>
            
            <category>backup</category>
            
            
        </item>
        
        <item>
            <title>VPC Peering 생성 가이드</title>
            <description>## 개요
VPC(virtual Private Cloud)는 퍼블릭클라우드상에서 제공되는 사설 가상 네트워크 입니다. 계정당 3개의 VPC를 만들수 있으며 다른 VPC 네트워크와 논리적으로 분리되어 있어 독립적인 네트워크 환경을 구현할 수 있습니다.  
그런데, 간혹 VPC 환경에서 분리되어 있는 VPC간의 통신이 필요할때가 있는데 이때 사용할 수 있는 서비스가 [**VPC Peering**] 입니다. 

VPC Peering은 공인 아이피를 거치지 않고 Ncloud 내부 네트워크를 이용하여 VPN없이 VPC간 통신을 할수 있게 해주는 서비스 입니다.

## VPC 생성
우선 테스트에 사용할 VPC로 [test-vpc], [test2-vpc] 이렇게 2개를 준비했습니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_01.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

## Subnet 생성 

이제 각 VPC에 서브넷을 생성합니다. [test-vpc]에는 [test-subnet(192.168.10.0/24)]으로 생성합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_07.png&quot; width=&quot;700&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

[test2-vpc]에는 [test2-subnet(172.16.10.0/24)]으로 생성합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_08.png&quot; width=&quot;700&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

생성된 Subnet은 다음과 같습니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_09.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}


## VPC Peering 생성
네이버 클라우드(Ncloud) 콘솔에서 [Networking] -&gt; [VPC] -&gt; [VPCPeering] 메뉴로 이동해서 [VPC peerig 생성] 버튼을 클릭합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_02.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

- ① 이름을 적고
- ② 요청 VPC는 [testVPC]를 선택
- ③ 수락 VPC는 [내계정], [test2VPC]를 선택

설정이 끝났으면 생성버튼을 클릭합니다.

{% include callout_v2.html type=&quot;success&quot; level=&quot;1&quot; content=&quot;다른 계정의 VPC와 연결하는 경우는 아래쪽에서 살펴보겠습니다.&quot; %}

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_03.png&quot; width=&quot;700&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

마지막으로 VPC Peering 요청 내용을 확인하고 [확인] 버튼을 클릭합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_17.png&quot; width=&quot;500&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

[test-vpc] -&gt; [test2-vpc]로 설정된 VPC Peering을 아래와 같이 확인할 수 있습니다.  

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_04.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

### 역방향 설정 추가
그런데 VPC peering은 단방향 통신이기에 TCP, ICMP 등의 양방향 통신을 하는 프로토콜을 이용하려면 역방향 즉, [test2-vpc] -&gt; [test-vpc]로 설정된 VPC Peering도 추가해야 합니다.

- ① 이름을 적고
- ② 요청 VPC에는 test2VPC를 선택
- ③ 수락 VPC에는 testVPC를 선택

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_05.png&quot; width=&quot;700&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

VPC Peering 요청 내용을 확인하고 [확인] 버튼을 클릭합니다. 

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_18.png&quot; width=&quot;500&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

아래와 같이 [test-vpc] -&gt; [test2-vpc] , [test2-vpc] -&gt; [test-vpc] 2가지 VPC Peering을 모두 생성했으므로 양방향 통신이 가능하게 되었습니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_06.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}


## Route Table 설정

이제 통신할 서브넷 혹은 서버의 아이피를 Route Table 설정에 추가 합니다. 여기서는 서브넷을 추가하도록 하겠습니다.

우선 [VPC] - [Route Table]에서, [test-vpc-default-public-table]의 [Routes 설정]을 클릭합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_11.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

- Destination에는 [test2-subnet]의 아이피 대역을 입력 (서버의 아이피로 입력해도 됨)  
- Target Type은 [VPCPEERING]을 선택
- Target Name은 [test-vpc-peering]을 선택

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_12.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

다음으로 [test2-vpc-default-public-table]의 [Routes 설정]을 클릭합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_13.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

- Destination에는 [test-subnet]의 아이피 대역을 입력 (서버의 아이피로 입력해도 됨)  
- Target Type은 [VPCPEERING]을 선택
- Target Name은 [test2-vpc-peering]을 선택

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_14.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

## 서버 준비
아래와 같이 테스트로 사용할 서버 2대를 준비했습니다.  
테스트는 [test-vpc]에 위치한 [test-vpc-peering-svr]서버 -&gt; [test2-vpc]에 위치한 [test2-vpc-peering-svr]로 접속 시도를 해보겠습니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_15.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

## ACG 설정
ACG를 설정하지 않고 [test-vpc-peering-svr] -&gt; [test2-vpc-peering-svr]로 접속 시도를 하면 접속이 되지 않는 것을 확인할 수 있습니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_19.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

[test2-vpc-peering-svr]로 접속할 것이므로 해당 서버에 설정된 acg인 [test2-vpc-default-acg]를 선택하고 [ACG 설정] 버튼을 클릭합니다. 

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_20.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

접근소스에는 [test-vpc-peering-svr] 서버의 subnet 대역인 [192.168.10.0/24]를 입력하고, 포트는 22번 포트를 입력하고 추가해서 적용합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_21.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

## 접속 테스트 
ACG 설정까지 완료하고 나서 다시 접속 테스트를 해보면 아래와 같이 접속이 잘 되는 것을 확인할 수 있습니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_22.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

## 다른 계정 VPC 연결
위에서는 동일한 내 계정에 생성된 VPC들 간의 Peering을 살펴보았는데, 아래에서는 다른 계정에 생성된 VPC와 연결할 때의 화면을 살펴보겠습니다.

VPC Peering 생성 화면에서 [다른 계정]을 선택하면 아래와 같이 [로그인 ID (이메일)], [VPC ID], [VPC 이름]을 입력하게 됩니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_23.png&quot; width=&quot;700&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

마찬가지로 VPC Peering 요청 내용을 확인하고 [확인] 버튼을 클릭합니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_24.png&quot; width=&quot;500&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

다음으로 수락을 요청받은 다른 계정의 VPC Peering 화면에 가면 요청 내용을 확인할 수 있고, 요청 응답에서 [수락] 버튼을 클릭합니다. 

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_25.png&quot; width=&quot;770&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

한번 더 VPC Peering 연결 요청을 수락할 것인지 확인하는 창이 나타납니다. 

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_26.png&quot; width=&quot;500&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

수락하고 나면 역방향의 VPC Peering 연결을 생성해야 한다는 안내와 함께 역방향 VPC Peering 생성 화면이 나타납니다.  
역방향은 위의 설정과 반대로 진행하면 되고, 그 이후에는 내 계정에서 설정했던 것과 마찬가지로 설정하시면 완료됩니다.

{% include image.html file=&quot;networking/ncloud_networking_vpc_peering_guide_27.png&quot; width=&quot;500&quot; alt=&quot;Ncloud VPC 환경에서 VPC Peering 생성 가이드&quot; caption=&quot;&quot; %}

## 제한사항

{% include callout_v2.html type=&quot;warning&quot; level=&quot;1&quot; content=&quot;
&amp;#8259; VPC Peering은 연결하려는 VPC들의 IP주소 대역이 달라야 합니다. &lt;br /&gt;
&amp;#8259; 일치되거나 중첩되는 대역이 있으면 설정되지 않습니다.&quot; %}
{% include callout_v2.html type=&quot;info&quot; level=&quot;1&quot; content=&quot;
&amp;#8259; VPC Peering은 단방향입니다. &lt;br /&gt;
&amp;#8259; TCP등 양방향 통신을 해야 하는 경우에는 요청 / 수락 VPC를 맞바꾸어 역방향 Peering도 추가 생성해야 합니다.&quot; %}
{% include callout_v2.html type=&quot;danger&quot; level=&quot;1&quot; content=&quot;
&amp;#8259; VPC Peering은 전이적 연결 관계를 지원하지 않습니다. &lt;br /&gt;
&amp;#8259; 즉, Peering된 VPC를 통하여 다른 VPC 혹은 외부로 통신하는 것은 불가능 합니다.&quot; %}
{% include callout_v2.html type=&quot;success&quot; level=&quot;1&quot; content=&quot;
&amp;#8259; VPC Peering은 동일한 리전 내 VPC 끼리만 연결할 수 있습니다.&quot; %}


## 참고 URL
1. VPC Peering 가이드
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/networking-vpc-vpcdetailedpeering&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/networking-vpc-vpcdetailedpeering&lt;/a&gt;

2. VPC Peering 설정 시나리오
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/networking-vpc-vpcuserscenario4&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/networking-vpc-vpcuserscenario4&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}  </description>
            <pubDate>Fri, 03 Nov 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/networking/ncloud_networking_vpc_peering_guide.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/networking/ncloud_networking_vpc_peering_guide.html</guid>
            
            <category>vpc</category>
            
            
        </item>
        
        <item>
            <title>Ncloud Security Monitoring WAF 서비스 요금 정보</title>
            <description>## 개요
Ncloud (네이버 클라우드) Security Monitoring 서비스는 무료인 Basic 서비스와 유료인 Managed 서비스가 있고, 그 중에서 유료 서비스인 Managed 서비스는 IDS, Anti-DOS, WAF, Anti-Virus, IPS 등 4가지 서비스를 모두 제공하고 있는데 그 중에서 WAF(Web Application Firewall) 서비스의 이용 요금 구성과 신청 시 주의 사항에 대해 정리해보겠습니다.

## 구성
WAF 서비스 장비는 [**WAF VM + WAF LB**]로 구성되어 있습니다. 따라서 사용 요금도 WAF VM 요금과 WAF LB 요금이 별도로 청구됩니다.

{% include image.html file=&quot;security/ncloud-security-security-monitoring-waf-guide-01.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud (네이버 클라우드) Security Monitoring WAF 구성도&quot; caption=&quot;&quot; %}


## 요금
&lt;div class=&quot;col-sm-12&quot;&gt;
&lt;table class=&quot;simple_table&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;상품명&lt;/th&gt;
      &lt;th&gt;과금 구간 (Mbps)&lt;/th&gt;
      &lt;th&gt;가격 (월 요금, VAT별도)&lt;/th&gt;
      &lt;th&gt;비고&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
        &lt;td rowspan=&quot;4&quot;&gt;WAF VM&lt;/td&gt;
        &lt;td&gt;0 ~ 100 이하&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;974,800 원&lt;/td&gt;
        &lt;td rowspan=&quot;4&quot;&gt;리전 단위 판매&lt;br /&gt;이중화 기본 제공&lt;br /&gt;(요금은 이중화 가격)&lt;/td&gt;
    &lt;/tr&gt; 
    &lt;tr&gt;        
        &lt;td&gt;100 초과 ~ 300 이하&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,174,800 원&lt;/td&gt;        
    &lt;/tr&gt; 
    &lt;tr&gt;        
        &lt;td&gt;300 초과 ~ 500 이하&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,474,800 원&lt;/td&gt;        
    &lt;/tr&gt;
    &lt;tr&gt;        
        &lt;td&gt;500 초과 ~ 1,000 이하&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;2,274,800 원&lt;/td&gt;        
    &lt;/tr&gt;  
    &lt;tr&gt;
        &lt;td&gt;WAF LB&lt;/td&gt;
        &lt;td&gt;WAF LB 1개당&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;25,200 원&lt;/td&gt;
        &lt;td&gt;WAF LB개수는 WAF 모니터링을 신청하려는&lt;br /&gt;도메인 개수 또는 인증서 개수를 의미&lt;/td&gt;
    &lt;/tr&gt; 
  &lt;/tbody&gt;
&lt;/table&gt;  
&lt;/div&gt;

### 과금 구간 기준
과금 구간을 결정, 변경하게 되는 기준은 **`월 기준 in/out 트래픽 중에서 Peak 트래픽입`**니다. 그러므로 월 기준으로 단 한번이라도 신청 구간을 초과할 경우 과금 기준이 변경될 수 있습니다.

### 서브 도메인의 요금
- **개별 인증서**를 사용하는 서브 도메인은 인증서 개수 만큼 WAF LB 요금이 추가 됩니다.
- **Wildcard 인증서**를 사용하는 서브 도메인은 추가 요금 없이, 개수 제한 없이 사용 가능합니다.
- 다만, 서브 도메인 개수나 트래픽에 따라 WAF LB 또는 WAF VM이 추가 되어 요금이 증가할 수 있습니다.

## 요금 예시

&lt;div class=&quot;col-sm-12&quot;&gt;
&lt;table class=&quot;simple_table&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;해당 월 Peak 트래픽&lt;/th&gt;   
      &lt;th&gt;도메인 또는&lt;br /&gt;인증서 개수&lt;/th&gt;   
      &lt;th&gt;WAF VM 요금 (VAT 별도)&lt;/th&gt;      
      &lt;th&gt;WAF LB 요금 (VAT 별도)&lt;/th&gt;
      &lt;th&gt;합계 (VAT 별도)&lt;br /&gt;&lt;br /&gt;(WAF VM 요금 + WAF LB 요금)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;    
    &lt;tr&gt;
        &lt;td&gt;160 Mbps&lt;/td&gt;        
        &lt;td&gt;1개&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,174,800 원&lt;/td&gt;        
        &lt;td style=&quot;text-align:right;&quot;&gt;25,200 원&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,200,000 원&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;160 Mbps&lt;/td&gt;        
        &lt;td&gt;2개&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,174,800 원&lt;/td&gt;        
        &lt;td style=&quot;text-align:right;&quot;&gt;50,400 원&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,225,200 원&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;300 Mbps&lt;/td&gt;        
        &lt;td&gt;1개&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,174,800 원&lt;/td&gt;        
        &lt;td style=&quot;text-align:right;&quot;&gt;25,200 원&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,200,000 원&lt;/td&gt;
    &lt;/tr&gt; 
    &lt;tr&gt;
        &lt;td&gt;301 Mbps&lt;/td&gt;        
        &lt;td&gt;1개&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,474,800 원&lt;/td&gt;        
        &lt;td style=&quot;text-align:right;&quot;&gt;25,200 원&lt;/td&gt;
        &lt;td style=&quot;text-align:right;&quot;&gt;1,500,000 원&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;  
&lt;/div&gt;

{% include callout-v2.html type=&quot;warning&quot; level=&quot;3&quot; content=&quot;WAF 이용 요금은 고객 서비스의 서버 정지와 무관하게 청구됩니다. 서버 정지와 함께 Security Monitoring 서비스의 WAF 계약도 함께 해지해야 과금되지 않습니다.&quot; %}

{% include callout-v2.html type=&quot;info&quot; level=&quot;3&quot; content=&quot;SLA 수준이 낮은 [단일구성 WAF서비스]를 이용하고자 하시면, 고객지원으로 문의하셔야 합니다.&quot; %}

## WAF 신청 시 주의 사항

### VPC

- **`Application Load Balancer 사용 필수`**: WAF는 Reverse Proxy 방식으로 사용자별 별도의 WAF 플랫폼을 구성하여 제공하고, HTTP/HTTPS 트래픽에 대한 보안 모니터링을 제공합니다. 따라서 Application Load Balancer를 사용하는 HTTP/HTTPS 서비스에만 제공이 가능합니다.
- **`서비스 도메인 필수`**: WAF 서비스를 사용하려면 사용자 서비스 도메인의 CNAME을 WAF Load Balancer 도메인 정보로 수정하여 트래픽이 WAF를 향하도록 설정해야 합니다. 그러므로 서비스 도메인이 있어야 서비스를 신청할 수 있습니다.
- **서비스 인증서 전달**: HTTPS 서비스 모니터링을 위해 WAF Load Balancer에 인증서를 설치해야 하며, 서비스 신청 시 사용자 서비스의 인증서도 함께 전달해야 합니다.
- **HTTP 80 리스너 설정**: WAF VM과 사용자 서비스 Application Load Balancer 간의 통신은 HTTP 80 port 공인 통신을 사용합니다. 그러므로 사용자 서비스 Application Load Balancer에 HTTP 80 리스너를 기본으로 구성해야 합니다.
- **리다이렉션 설정**: WAF Load Balancer에서 80 포트에 대한 443 리다이렉트 설정도 기본으로 지원하고 있습니다. 따라서 WAF 서비스를 정상적으로 사용하려면 사용자의 Application Load Balancer나 서버에서 HTTP -&gt; HTTPS 리다이렉트가 있는 경우 삭제해야 합니다.
- **HTTP 프로토콜 설정**: HTTPS 모니터링 신청 시, 신청한 Application Load Balancer 리스너에 HTTP 프로토콜 설정이 필요합니다.
- **CNAME 설정**: WAF(V2) 제공을 위해서 고객 대상 도메인에 CNAME 설정을 해야 합니다. 고객 대상 도메인이 Base 도메인인 경우, CNAME 설정이 불가능하오니 A레코드에 WAF VIP로 설정합니다. 그리고, WAF 구성 후 고객에게 CNAME에 등록할 WAF Load Balancer 도메인 설정 정보 전달 예정입니다.


### Classic
- **HTTP/HTTPS 표준 프로토콜 사용 필수**: WAF는 HTTP/HTTPS 표준 프로토콜을 사용하는 웹 서비스에 대한 보안 모니터링을 제공합니다. 따라서 네이버 클라우드 플랫폼의 Load Balancer를 사용 중인 서비스에 대한 모니터링을 하려면 Load Balancer Protocol을 반드시 HTTP, HTTPS로 설정해야 합니다. 만약 TCP, SSL로 설정하는 경우 WAF 서비스를 사용할 수 없습니다.



## 참고 URL
1. Ncloud Security Monitoring 서비스 안내
- &lt;a href=&quot;https://www.ncloud.com/product/security/securityMonitoring&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://www.ncloud.com/product/security/securityMonitoring&lt;/a&gt;

2. Ncloud Security Monitoring 가이드 
- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/securitymonitoring-overview&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/securitymonitoring-overview&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}</description>
            <pubDate>Fri, 03 Nov 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/security/ncloud-security-security-monitoring-waf-price-info.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/security/ncloud-security-security-monitoring-waf-price-info.html</guid>
            
            <category>security</category>
            
            <category>monitoring</category>
            
            
        </item>
        
        <item>
            <title>Ncloud 데이터베이스 마이그레이션 서비스 | From MariaDB To MySQL 8.0</title>
            <description>## 개요
Ncloud(네이버 클라우드)의 Database Migration Service는 다양한 환경의 데이터베이스를 클라우드 환경으로 손쉽게 마이그레이션하도록 도와주는 서비스로 여기서는 **Public** 환경의 [**MariaDB**]를 **Private** 환경의 [**Cloud DB for MySQL 8.0**]으로 마이그레이션하는 방법에 대해 정리해보겠습니다.

## 서비스에서 제공하는 기능
- **마이그레이션의 단계별 작업 자동화**: Migration 작업을 생성하여 마이그레이션에 필요한 단계별 작업 자동화
- **Endpoint 관리 기능**: 손쉽게 Source DB Endpoint 생성 및 관리 가능
- **연결 테스트 기능**: 마이그레이션 실행 전 Source DB와 Target DB 간 연결 테스트 진행
- **마이그레이션 작업 내역 모니터링**: 마이그레이션 작업 상태와 내역 조회 가능

## 지원 데이터베이스
Database Migration Service는 MySQL 데이터베이스 간 마이그레이션을 지원합니다.

- Major 버전이 동일한 데이터베이스 간의 마이그레이션이 권장됩니다.
- Source DB는 MariaDB도 가능합니다.
- Target DB는 MySQL만 가능합니다.

{% include callout-v2.html type=&quot;warning&quot; level=&quot;4&quot; content=&quot;
&amp;#8259; MariaDB도 마이그레이션이 가능하지만 MySQL 8.0과의 호환성 문제로 마이그레이션이 실패할 수도 있습니다. &lt;br /&gt;
&amp;#8259; 마이그레이션이 실패했을 경우에는  MariaDB &lt;i class=&apos;fa-solid fa-right-long&apos; &gt;&lt;/i&gt; MySQL 5.7 &lt;i class=&apos;fa-solid fa-right-long&apos; &gt;&lt;/i&gt;  MySQL 8.0 이렇게 2단계로 마이그레이션 하는 방법을 시도해보시기 바랍니다.
&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-41.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 상세 설정 지원 여부
Source DB의 상세 설정에 따른 지원 여부는 다음과 같습니다.

### 지원 항목
- 데이터베이스, TABLE의 캐릭터셋(CharacterSet): euckr, utf8(utf8mb3), utf8mb4 지원
- Table, View, Stored Procedure, Function, Trigger 마이그레이션 지원

### 미지원 항목
- TABLE ENGINE: MyISAM, BLACKHOLE, FEDERATED, ARCHIVE 미지원
- 사용자 계정 정보, MariaDB Config 항목, Event 마이그레이션 미지원


## 마이그레이션 진행 구조
마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근하여 DB 데이터를 가져오는 방식`**으로 진행됩니다.   

또한 작업 진행 단계는 다음과 같습니다.
1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 완료 상태
4. 마이그레이션 작업 완료

## 서비스 점검
마이그레이션 작업을 진행할 때 서비스 점검을 언제할 것인가가 중요한 고려사항이 됩니다. 물론 가장 안전한 방법은 마이그레이션 작업 전에 서비스 점검을 시작하는 것이지만, DB의 용량이 클 경우는 [**Export**], [**Import**] 각각 몇 시간씩 소요될 수 있는데, 오랜 시간 서비스 점검을 하려면 부담이 될 수 밖에 없습니다.  
그러므로 오랜 시간 동안 서비스 점검을 하기 어려울 경우 다음과 같이 진행하면 되겠습니다.  

마이그레이션에서 [**Export**], [**Import**] 작업이 끝나면 두 DB간의 **Replication** 상태가 유지되는데 이때는 [**Source DB**]에 새로운 데이터가 추가되면 자동으로 [**Target DB**]로 복제가 됩니다. 그러므로 두 DB 간의 **Replication**이 완료 상태에서 서비스 점검을 시작하고 최종 마이그레이션 작업이 완료된 후에 서비스 점검을 종료하면 됩니다. 

1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 상태
4. 서비스 점검 시작
5. 마이그레이션 작업 완료
6. 서비스 점검 종료

## 테스트 환경
Source DB는 Ncloud(네이버 클라우드) 외부에 위치한 경우가 많을 것으로 예상되므로 다음과 같은 사항들을 가정하고 테스트 환경을 준비해보겠습니다.

- **Source DB**와 **Target DB**가 사설 네트워크로 접근이 불가능한 **서로 다른 네트워크 환경**에 존재한다.
- **Source DB**는 외부에서 공인 IP로 접근 가능한 **Public 네트워크 환경**에 존재한다.
- **Target DB**는 외부에서 접근이 불가능한 **Private 네트워크 환경**에 존재한다.
- **Target DB**는 `NAT Gateway`를 통해서 **Source DB**에 접근한다.

### DB 버전 정보
- Source DB: CentOS 7.8, MariaDB 10.4.31
- Target DB: Cloud DB for MySQL 8.0.32

{% tabs db-verstion %}

{% tab db-verstion Source DB %}

&amp;#8259; **Source DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-00.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab db-verstion Target DB %}

&amp;#8259; **Target DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-06.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

### Source DB 정보 확인
테스트에 사용할 Source DB의 버전, Database, DB User 등의 정보를 확인해보겠습니다.

{% tabs sourcedb-setting %}

{% tab sourcedb-setting MariaDB 버전 %}

&amp;#8259; **MariaDB 버전**  
테스트에 사용할 DB는 아래에서 확인할 수 있듯이 MariaDB 5.7.43입니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-01.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Database %}

&amp;#8259; **Database**  
테스트를 위해 testdb1, testdb2 이렇게 2개의 DB를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-02.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting 계정 %}

&amp;#8259; **계정**  
테스트를 위한 abcd1, abcd2 이렇게 2개의 DB User를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-03.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Table %}

&amp;#8259; **Table**  
테스트용 Database에 sampletable1, sampletable2 이렇게 각각 테이블을 1개씩 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-04.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Procedure %}

&amp;#8259; **Procedure**  
테스트용 Database testdb2에 new_procedure2라는 이름의 Procedure를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-05.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

## Source DB 사전 설정

### 마이그레이션 전용 DB User 생성
마이그레이션을 위한 전용 유저 즉, Target DB에서 Source DB로 접속할 때 사용할 DB User를 아래와 같이 생성합니다.

- 패스워드는 최소 8자 이상, 최대 21 자까지만 입력이 가능합니다.  
영문 / 특수문자 / 숫자가 포함되어야 합니다.  
` &amp; + \ &quot; &apos; / 스페이스 는 패스워드로 사용할 수 없습니다.  
- 기본 시스템DB를 제외한 사용자가 추가로 생성한 모든 데이터베이스에 대해 권한을 부여합니다.

``` sql
CREATE USER &apos;migration_test&apos;@&apos;%&apos; IDENTIFIED BY &apos;[패스워드]&apos;;
GRANT RELOAD, PROCESS, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT ON mysql.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT, SHOW VIEW, LOCK TABLES, TRIGGER ON [사용자 생성 DB].* TO &apos;migration_test&apos;@&apos;%&apos;;
FLUSH PRIVILEGES;
```

- 위쪽에서 Source DB에 테스용으로 [**testdb1**], [**testdb2**] 이렇게 2개를 데이터베이스가 존재하므로 두 개의 데이터베이스 각각에 대해 권한을 부여했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-06.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Character Set 점검
Target DB로 생성되는 Cloud DB for MySQL은 [**utf8, utf8mb4, euckr**] Character Set만 지원합니다.  
Source DB에 이 외의 설정으로 되어 있다면 Character Set을 변경 후 마이그레이션을 진행해야 합니다.

- Character Set 점검 쿼리  

``` sql
SELECT character_set_name
FROM information_schema.TABLES T, information_schema.COLLATION_CHARACTER_SET_APPLICABILITY CCSA
WHERE CCSA.collation_name = T.table_collation 
AND TABLE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND CCSA.character_set_name NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos; );

SELECT DEFAULT_CHARACTER_SET_NAME
FROM information_schema.SCHEMATA T
WHERE SCHEMA_NAME NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND DEFAULT_CHARACTER_SET_NAME NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos;);
```

- Character Set 변경 쿼리 예시 

``` sql
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8;
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8 COLLATE utf8_general_ci;
ALTER TABLE [테이블명] CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci;
```

### sql_mode 설정 점검 {#sql_mode}
MariaDB에서 지원하는 sql_mode=&apos;NO_AUTO_CREATE_USER&apos; 설정은 MySQL 8.0 버전에서는 지원하지 않기 때문에, Source DB에서 사용된 곳이 있으면 찾아서 해당 옵션을 제거해야 합니다.

#### sql_mode 설정 점검 쿼리
Procedure, Function 등의 ROUTINE과 TRIGGER에서 사용되므로 아래 쿼리로 [**NO_AUTO_CREATE_USER**] 옵션이 사용된 곳이 있는지 점검합니다.

``` sql
SELECT ROUTINE_SCHEMA, ROUTINE_NAME, SQL_MODE
FROM information_schema.routines
WHERE ROUTINE_SCHEMA NOT IN (&apos;sys&apos;,&apos;mysql&apos;);

SELECT TRIGGER_SCHEMA, TRIGGER_NAME, sql_mode
FROM information_schema.triggers
WHERE TRIGGER_SCHEMA NOT IN (&apos;sys&apos;,&apos;mysql&apos;);
```

- 테스트용 Source DB에서 점검 쿼리를 실행해보면 아래와 같이 [**testdb2**]의 [**new_procedure2**]에 [**NO_AUTO_CREATE_USER**] 옵션이 적용되어 있는 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-07.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### sql_mode 호환성 이슈 조치 방법
Procedure, Function, Trigger의 Dump 파일을 생성하고 [**NO_AUTO_CREATE_USER**] 옵션을 제거한 후 다시 적용하면 됩니다.

- Procedure, Function, Trigger 에 대해서만 drop 및 create 구문이 생성된 sql 파일 생성  

``` bash
~# mariadb-dump -u {사용자명} -p  --routines --triggers  --no-create-info --no-data --no-create-db --add-drop-trigger --databases {사용자 DB} &gt; backup.sql
```
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-08.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- backup.sql 파일내 NO_AUTO_CREATE_USER 구문 모두 제거  
해당 옵션을 일일이 찾아서 제거하기 힘드니 vim 에디터에서 [**NO_AUTO_CREATE_USER**] 문자를 찾아서 제거하는 명령을 실행합니다.  
경우에 따라서는 Dump 파일에 [**NO_AUTO_CREATE_USER**] 옵션이 포함되지 않는 경우도 있습니다. 이때는 걱정말고 Dump 파일을 그냥 그대로 적용하면 됩니다.

``` bash   
vim 명령: %s /NO_AUTO_CREATE_USER,//g

원본 예시: SET sql_mode = &apos;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;  
수정 예시: SET sql_mode = &apos;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION&apos;
```
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-09.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- 적용하기  
수정된 Dump 파일을 Source DB에 적용합니다.

``` bash
~# mariadb -u {사용자명} -p {사용자 DB} &lt; backup.sql
```
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-10.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### sql_mode 설정 변경 확인
설정이 제대로 변경되었는지 점검 쿼리로 다시 확인해보겠습니다.

``` sql
SELECT ROUTINE_SCHEMA, ROUTINE_NAME, SQL_MODE
FROM information_schema.routines
WHERE ROUTINE_SCHEMA NOT IN (&apos;sys&apos;,&apos;mysql&apos;);
```

- 아래 스샷처럼 [**NO_AUTO_CREATE_USER**] 옵션이 사라진 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-11.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


### 바이너리 로그 설정 {#log_bin}
Source DB의 바이너리 로그 설정 중에서, [**server_id**] 값이 설정되어 있는지와 [**log_bin**]이 ON 상태로 설정되어 있지 확인 후 설정되어 있지 않다면 설정 후에 진행해야 합니다.

#### 현재 설정 확인  
아래 쿼리를 사용해 현재 설정 값을 확인합니다.  

``` sql
show variables like &apos;server_id&apos;;
show variables like &apos;log_bin&apos;;
```

- 현재 테스트용 Source DB는 [**server_id**]는 설정되어 있고, [**log_bin**]은 설정되어 있지 않은 상태입니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-12.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 설정 변경
MariaDB의 환경 설정 파일 [**server.cnf**]를 열어서 아래 값을 추가하고, MariaDB 데몬을 재시작합니다.
``` bash
~# vim /etc/my.cnf.d/server.cnf

log-bin
log-basename = mariadb
binlog-format = mixed
character-set-server = utf8

~# systemctl restart mariadb
```

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-13.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-14.png&quot; sub-class=&quot;docimage-no-top&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 변경 설정 확인  
설정 변경 후에 확인해보면 아래와 같이 [**server_id**] 값이 설정되어 있고, [**log_bin**]이 ON 상태로 변경된 것을 알 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-15.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## Target DB 사전 설정
위에서 [Source DB]의 사전 설정이 끝났으므로 이제 [**Target DB**]의 사전 설정이 필요한 항목을 확인해보겠습니다.

### DEFINER 계정 확인 {#DEFINER}
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재한다면 이 때 사용된 DB User 즉, [**DEFINER**] 계정을 [**Target DB**]에도 미리 추가 생성해 두어야 마이그레이션을 진행할 수 있습니다.

아래 쿼리는 [**Procedure**], [**Function**], [**VIEW**] 등을 생성할 때 사용된 [**DEFINER**] 계정을 확인하는 쿼리입니다.  

``` sql
SELECT DEFINER FROM information_schema.ROUTINES
WHERE ROUTINE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos;;

SELECT DEFINER FROM information_schema.VIEWS
WHERE table_schema NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos; ;
```

- 위에서 [**Source DB**]에 테스트 환경을 설정하면서 [**Procedure**]를 하나 생성했었는데 그때 사용된 [**DEFINER**] 계정을 확인할 수 있었습니다. 여기서 확인된 DB User를 [**Target DB**]에 미리 추가 생성해 두어야 합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-16.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;3&quot; content=&quot;위 단계에서 DEFINER User가 없는 것으로 확인될 경우 DEFINER User 추가 없이 다음 단계로 진행하셔도 됩니다.&quot; %}

### DEFINER 계정 추가
[**Target DB**]를 선택하고 [**DB 관리**] - [**DB User 관리**] 메뉴를 선택합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-25.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- DB User 관리 화면에서 위에서 확인했던 [**DEFINER**] 계정을 DDL 권한으로 설정해서 추가하고 저장합니다. 
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-24.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 접근 권한 설정 {#ACG}
[**Source DB**], [**Target DB**] 양쪽의 사전 설정을 모두 완료했으면, 다음으로는 양쪽 DB간의 접근 권한을 설정해야 합니다.  
앞에서도 설명했지만 마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하게 됩니다.

### NAT Gateway 생성
현재 [**Target DB**]는 [**Private**] 네트워크 환경에 위치해 있으므로 [**Source DB**]로 접근하기 위해서는 [**NAT Gateway**]를 생성해서 외부 통신이 가능하도록 해야 합니다.  
여기서는 [**NAT Gateway**]가 생성되어 있다고 가정하고, 어떻게 설정하는지 확인해보겠습니다.  

- [**NAT Gateway**] 상세 정보 중에서 [**공인 IP**]는 따로 기록해 두었다가, 아래쪽에서 [**방화벽(ACG) 설정**]에서 사용하게 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-15.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

VPC 환경에서 [**NAT Gateway**]를 생성하는 상세한 방법은 아래 문서를 참고하시면 됩니다.

{% include callout-v2.html type=&quot;info&quot; level=&quot;2&quot; content=&quot;
&amp;#8259; &lt;a href=&apos;/networking/ncloud_networking_natgw_routetb.html&apos; target=&apos;_blank&apos; style=&apos;word-break:break-all;&apos;&gt;VPC 환경에서 NAT Gateway 생성하는 방법&lt;/a&gt;
&quot; %}

### Route Table 설정
다음으로 [**VPC**] - [**Route Table**]에서 [**Target DB**]의 Subnet에 연관된 [**Route Table**]을 선택하고, [**Routes 설정**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-16.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- **Route Table 설정** 화면에서 [**Destination**]에는 [**Source DB**]의 공인 IP를 입력하고, [**Target Type**]은 [**NATGW**], [**Target Name**]은 위에서 생성했던 **NAT Gateway**를 선택하고 [**생성**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-17.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 방화벽(ACG) 설정
**`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하여 DB 데이터를 가져오기 위해 [**Target DB**] 방화벽에서는 [**Outbound**] 규칙을,  [**Source DB**] 방화벽에서는 [**Inbound**] 규칙을 설정해야 합니다.

#### Target DB ACG 설정
우선 [**Target DB**]의 [**Outbound**] 규칙을 설정해보겠습니다. [**Target DB**]를 선택하면 나타나는 DB 상세 정보 화면에서 [**ACG**]를 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-26.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG**] 화면에서 해당 ACG를 선택하고 [**ACG 설정**] 메뉴를 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-08.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG 규칙 설정**] 팝업에서 [**Outbound**] 탭을 선택하고, [**목적지**]에는 [**Source DB**]의 IP 주소, [**허용 포트**]에는 [**Source DB**]의 포트 번호를 입력한 후 [**추가**]-[**적용**] 버튼을 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-09.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


#### Source DB 방화벽 설정
이제 [**Source DB**] 방화벽에 위에서 확인했던 [**NAT Gateway**]의 [**공인 IP**]를 추가해서 [**Taget DB**]가 접근할 수 있도록 설정하겠습니다.

- On Premise 등 Ncloud 외부 서버의 경우 자체 방화벽에 직접 추가하시면 됩니다.  

- Ncloud 내부 서버의 경우 해당 서버의 ACG의 [**Inbound**] 설정에 아래처럼 추가하면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-18.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 서비스 위치
이제 모든 준비를 마쳤으면 본격적으로 마이그레이션 작업을 진행해보겠습니다.  
[**Database Migration**] 서비스는 [**Services**] - [**Database**] - [**Database Migration**]에 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-19.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 설정
[**Source DB**]와 [**Target DB**]에서 사전 준비가 끝났으면 이제 [**Database Migration Service**] 설정을 시작합니다.

### Endpoint 설정 {#Endpoint}
우선 [**Database Migration Service**] - [**Endpoint Management**] 메뉴에서 [**Endpoint 생성**] 버튼을 클릭합니다.  
여기서 [**Endpoint**]는 [**Source DB**]를 지칭하는 것으로 [**Source DB**]의 정보를 입력한다고 생각하시면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-20.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

다음으로 Endpoint 생성화면에서 [**Source DB**] 관련 정보를 입력하고 [**생성**] 버튼을 클릭합니다.
- **Endpoint URL**: **Source DB의 IP 또는 도메인**을 입력합니다.
- **DB PORT**: Source DB의 Port를 입력합니다.
- **DB User**: 위에서 Source DB에 생성했던 **마이그레이션 전용 DB User**를 입력합니다.
- **DB Password**: 마이그레이션 전용 DB User의 패스워드를 입력합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-21.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 작업 생성
[**Database Migration Service**] - [**Migration Management**] 메뉴에서 [**Migration 작업생성**] 버튼을 클릭합니다. 

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-25.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Test Connection
[**Source DB**] 항목과 [**Target DB**] 항목을 선택한 후에 [**Test Connection**] 버튼을 클릭해 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**을 테스트 해봅니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-26.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 시작
[**Test Connection**]에서 이상이 없을 경우 아래와 같이 옮겨오게 될 [**Source DB**]의 정보를 확인할 수 있습니다. 문제가 없으면 [**Migration 작업시작**] 버튼을 클릭해서 마이그레이션 작업을 시작합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-17.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 진행 상태
마이그레이션 작업은 [**Exporting**], [**Importing**], [**Replication**] 이렇게 3가지 단계로 진행되는데, 각각의 진행 상태를 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-18.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-19.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 진행 상태 확인 메일
진행 상태는 콘솔에서도 확인할 수 있지만, 작업이 오래 걸리는 경우도 대비해서 각 단계가 완료될 때마다 안내 메일이 발송됩니다.

{% tabs migration-status %}

{% tab migration-status Export Completed %}

&amp;#8259; **Export Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-30.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Import Completed %}

&amp;#8259; **Import Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-31.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Migration Completed %}

&amp;#8259; **Migration Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-32.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;
이 단계까지 완료되면 현재 상태는 **Source DB**와 **Target DB**간의 **Replication**이 완료된 상태이므로 이때 서비스 점검을 시작하고 아래쪽의 마이그레이션 **완료** 버튼을 클릭해서 최종 완료를 확인한 후에 서비스 점검을 종료하면 되겠습니다. 
&quot; %}

## 마이그레이션 완료
마이그레이션 작업이 완료되면 아래와 같이 콘솔화면에서 [**완료**] 버튼이 활성화 됩니다. 즉, 현재는 [**Replication**] 작업이 완료된 상태로 [**Source DB**]와 [**Target DB**]가 동기화 되어 있고, [**Target DB**]는 [**쓰기 불가**] 상태입니다.  

그러므로 [**완료**] 버튼 클릭해야 모든 작업이 완료되고, [**Target DB**]가 [**쓰기 가능**] 상태로 변경됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-20.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**완료**] 버튼 클릭하면 아래와 같이 안내 메시지가 출력되고 [**확인**] 버튼을 클릭하면 완료됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-34.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 최종 완료
최종 완료가 되면 아래와 같이 [**Migration Status**] 상태가 **완료**상태로 변경되고 [**Migration 종료 일시**]로 기록됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-21.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## Target DB 데이터 확인
마이그레이션이 모두 완료되었으므로 [**Source DB**]의 데이터가 [**Target DB**]로 모두 이상 없이 마이그레이션 되었는지 [**Target DB**]에 접속해서 직접 확인해보겠습니다.  
확인해보는 방법은 [**Target DB**]와 동일한 [**Subnet**]에 테스터 서버를 생성하고,  [**Target DB**]에 접속해서 [**Database**], [**Table**], [**Procedure**] 등이 정상적으로 존재하는지 살펴보는 것인데, 아래 스샷처럼 모두 이상이 없는 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-27.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## 오류 상황
지금부터는 마이그레이션 진행 중에 나타날 수 있는 오류 메시지 관련해서 정리해보고, 해결 방법을 알아보겠습니다.

### 방화벽 설정 오류  
[**Source DB**]의 방화벽 Inbound 설정과 [**Target DB**]의 ACG Outbound 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [접근 권한 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#ACG) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 와 Target DB 서버 통신이 되지 않습니다. &lt;br/&gt;Source DB Inbound 와 Target DB Outbound ACG 를 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-36.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Endpoint DB User 설정 오류  
[**Endpoint 설정**]에서 [**DB User**] 또는 [**DB Password**] 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [Endpoint 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#Endpoint) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 에 접속이 되지 않습니다.&lt;br /&gt;DB ACL 을 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-37.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### DEFINER 계정 생성 오류
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재하고, 이때 사용된 DB User 즉, [**DEFINER**] 계정이 [**Target DB**]에 존재하지 않았을 경우 나타나는 메시지 입니다. [DEFINER 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#DEFINER) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB에 생성된 Definer 계정이 Target DB 에 존재하지 않습니다.&lt;br /&gt;Definer 에 사용된 계정은 먼저 생성후 진행해 주세요.&lt;br /&gt;필요 Definer 계정 : abcd2@%&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-38.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


### 바이너리 로그 설정 오류
Source DB의 바이너리 로그 설정 중에서, [server_id], [log_bin] 관련 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [바이너리 로그 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#log_bin) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;마이그레이션을 위해서는 Source DB Config 설정이 필요합니다.&lt;br /&gt;추가 필요 설정 : log_bin&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-39.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


### sql_mode 설정 오류
[**Source DB**] 사전 설정에서 sql_mode 관련된 설정을 수정하지 않았을 경우 아래와 같이 마이그레이션 진행 중에 [**Importing**] 단계에서 실패가 발생하고 [**에러 보기**] 버튼을 클릭하면 아래와 같은 메시지가 나타납니다. [sql_mode 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#sql_mode) 내용을 다시 확인해주세요.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-22.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;ERROR 1234 (42000) at line 98: Variable &apos;sql_mode&apos; can&apos;t be set to the value of &apos;NO_AUTO_CREATE_USER&apos;&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-13.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 마이그레이션 재실행
위와 같이 [**sql_mode**] 관련 오류로 마이그레이션 작업이 실패했을 경우에는 [**재시작**] 버튼으로 재시작을 할 경우에는 동일한 오류가 계속 발생하게 됩니다.   
이때는 [**sql_mode**] 설정을 수정한 후에 마이그레이션 작업을 삭제하고, [**Target DB**]에 생성된 [**Database**]을 모두 삭제 후에 마이그레이션 작업을 다시 생성해야 정상 작동합니다.

- [**sql_mode**] 설정을 수정한 후에 [**삭제**] 버튼을 클릭해서 마이그레이션 작업을 삭제합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-23.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**Target DB**]의 [**DB 관리**] - [**DB Server 상세보기**] 메뉴를 클릭해서 [**Database 관리**] 기능으로 이동합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mariadb-to-mysql80-guide-24.png&quot; sub-class=&quot;docimage-no-bottom&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MariaDB에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**Database 관리**]에서 [**Source DB**]에서 Import한 [**Database**]을 모두 삭제하고, [**저장**] 버튼을 클릭합니다.  
그런 후에 마이그레이션 작업을 다시 생성해야 정상 작동합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-15.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 참고 URL
1. Database Migration Service 개요
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/ko/dms-overview&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/ko/dms-overview&lt;/a&gt;

2. Source DB 및 Target DB 접속 설정
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/dms-connect&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/dms-connect&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}  
</description>
            <pubDate>Thu, 02 Nov 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mariadb-to-mysql80-guide.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mariadb-to-mysql80-guide.html</guid>
            
            <category>database</category>
            
            <category>vpc</category>
            
            <category>MariaDB</category>
            
            
        </item>
        
        <item>
            <title>Ncloud 데이터베이스 마이그레이션 서비스 | From MySQL 8.0 To MySQL 8.0</title>
            <description>## 개요
Ncloud(네이버 클라우드)의 Database Migration Service는 다양한 환경의 데이터베이스를 클라우드 환경으로 손쉽게 마이그레이션하도록 도와주는 서비스로 여기서는 **Public** 환경의 MySQL 8.0을 **Private** 환경의 [**Cloud DB for MySQL 8.0**]으로 마이그레이션하는 방법에 대해 정리해보겠습니다.

## 서비스에서 제공하는 기능
- **마이그레이션의 단계별 작업 자동화**: Migration 작업을 생성하여 마이그레이션에 필요한 단계별 작업 자동화
- **Endpoint 관리 기능**: 손쉽게 Source DB Endpoint 생성 및 관리 가능
- **연결 테스트 기능**: 마이그레이션 실행 전 Source DB와 Target DB 간 연결 테스트 진행
- **마이그레이션 작업 내역 모니터링**: 마이그레이션 작업 상태와 내역 조회 가능

## 지원 데이터베이스
Database Migration Service는 MySQL 데이터베이스 간 마이그레이션을 지원합니다.

- Major 버전이 동일한 데이터베이스 간의 마이그레이션이 권장됩니다.
- Source DB는 MariaDB도 가능합니다.
- Target DB는 MySQL만 가능합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-41.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 상세 설정 지원 여부
Source DB의 상세 설정에 따른 지원 여부는 다음과 같습니다.

### 지원 항목
- 데이터베이스, TABLE의 캐릭터셋(CharacterSet): euckr, utf8(utf8mb3), utf8mb4 지원
- Table, View, Stored Procedure, Function, Trigger 마이그레이션 지원

### 미지원 항목
- TABLE ENGINE: MyISAM, BLACKHOLE, FEDERATED, ARCHIVE 미지원
- 사용자 계정 정보, MySQL Config 항목, Event 마이그레이션 미지원

## 마이그레이션 진행 구조
마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근하여 DB 데이터를 가져오는 방식`**으로 진행됩니다.   

또한 작업 진행 단계는 다음과 같습니다.
1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 완료 상태
4. 마이그레이션 작업 완료

## 서비스 점검
마이그레이션 작업을 진행할 때 서비스 점검을 언제할 것인가가 중요한 고려사항이 됩니다. 물론 가장 안전한 방법은 마이그레이션 작업 전에 서비스 점검을 시작하는 것이지만, DB의 용량이 클 경우는 [**Export**], [**Import**] 각각 몇 시간씩 소요될 수 있는데, 오랜 시간 서비스 점검을 하려면 부담이 될 수 밖에 없습니다.  
그러므로 오랜 시간 동안 서비스 점검을 하기 어려울 경우 다음과 같이 진행하면 되겠습니다.  

마이그레이션에서 [**Export**], [**Import**] 작업이 끝나면 두 DB간의 **Replication** 상태가 유지되는데 이때는 [**Source DB**]에 새로운 데이터가 추가되면 자동으로 [**Target DB**]로 복제가 됩니다. 그러므로 두 DB 간의 **Replication**이 완료 상태에서 서비스 점검을 시작하고 최종 마이그레이션 작업이 완료된 후에 서비스 점검을 종료하면 됩니다. 

1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 상태
4. 서비스 점검 시작
5. 마이그레이션 작업 완료
6. 서비스 점검 종료

## 테스트 환경
Source DB는 Ncloud(네이버 클라우드) 외부에 위치한 경우가 많을 것으로 예상되므로 다음과 같은 사항들을 가정하고 테스트 환경을 준비해보겠습니다.

- **Source DB**와 **Target DB**가 사설 네트워크로 접근이 불가능한 **서로 다른 네트워크 환경**에 존재한다.
- **Source DB**는 외부에서 공인 IP로 접근 가능한 **Public 네트워크 환경**에 존재한다.
- **Target DB**는 외부에서 접근이 불가능한 **Private 네트워크 환경**에 존재한다.
- **Target DB**는 `NAT Gateway`를 통해서 **Source DB**에 접근한다.

### DB 버전 정보
- Source DB: CentOS 7.8, MySQL 8.0.35
- Target DB: Cloud DB for MySQL 8.0.32

{% tabs db-verstion %}

{% tab db-verstion Source DB %}

&amp;#8259; **Source DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-00.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab db-verstion Target DB %}

&amp;#8259; **Target DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-06.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

### Source DB 정보 확인
테스트에 사용할 Source DB의 버전, Database, DB User 등의 정보를 확인해보겠습니다.

{% tabs sourcedb-setting %}

{% tab sourcedb-setting MySQL 버전 %}

&amp;#8259; **MySQL 버전**  
테스트에 사용할 DB는 아래에서 확인할 수 있듯이 MySQL 8.0.35입니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-01.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 8.0에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Database %}

&amp;#8259; **Database**  
테스트를 위해 testdb1, testdb2 이렇게 2개의 DB를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-02.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting 계정 %}

&amp;#8259; **계정**  
테스트를 위한 abcd1, abcd2 이렇게 2개의 DB User를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-03.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Table %}

&amp;#8259; **Table**  
테스트용 Database에 sampletable1, sampletable2 이렇게 각각 테이블을 1개씩 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-04.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Procedure %}

&amp;#8259; **Procedure**  
테스트용 Database testdb2에 new_procedure2라는 이름의 Procedure를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-05.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

## Source DB 사전 설정

### 마이그레이션 전용 DB User 생성
마이그레이션을 위한 전용 유저 즉, Target DB에서 Source DB로 접속할 때 사용할 DB User를 아래와 같이 생성합니다.

- 패스워드는 최소 8자 이상, 최대 21 자까지만 입력이 가능합니다.  
영문 / 특수문자 / 숫자가 포함되어야 합니다.  
` &amp; + \ &quot; &apos; / 스페이스 는 패스워드로 사용할 수 없습니다.  
- 반드시 **`mysql_native_password 형식`**으로 생성된 패스워드를 사용해야 합니다.
- 기본 시스템DB를 제외한 사용자가 추가로 생성한 모든 데이터베이스에 대해 권한을 부여합니다.
- MySQL **8.0.20 이상**은 8.0.19 이하 버전과 다르게 ROUTINE Dump를 위한 **SHOW_ROUTINE** 권한이 필수이니 버전에 맞게 쿼리를 사용해야 합니다.

{% tabs sourcedb-mig-user %}

{% tab sourcedb-mig-user 8.0.20 이상 %}

&amp;#8259; 위쪽에서 Source DB에 테스용으로 [**testdb1**], [**testdb2**] 이렇게 2개를 데이터베이스가 존재하므로 두 개의 데이터베이스 각각에 대해 권한을 부여했습니다.

``` sql
CREATE USER &apos;migration_test&apos;@&apos;%&apos; IDENTIFIED WITH &apos;mysql_native_password&apos;  BY &apos;[패스워드]&apos;;
GRANT SHOW_ROUTINE, RELOAD, PROCESS, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT ON mysql.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT, SHOW VIEW, LOCK TABLES, TRIGGER ON [사용자 생성 DB].* TO &apos;migration_test&apos;@&apos;%&apos;;
FLUSH PRIVILEGES;
```

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-08.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 8.0에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-mig-user 8.0.19 이하 %}

&amp;#8259; 위쪽에서 Source DB에 테스용으로 [**testdb1**], [**testdb2**] 이렇게 2개를 데이터베이스가 존재하므로 두 개의 데이터베이스 각각에 대해 권한을 부여했습니다.

``` sql
CREATE USER &apos;migration_test&apos;@&apos;%&apos; IDENTIFIED WITH &apos;mysql_native_password&apos;  BY &apos;[패스워드]&apos;;
GRANT RELOAD, PROCESS, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT ON mysql.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT, SHOW VIEW, LOCK TABLES, TRIGGER ON [사용자 생성 DB].* TO &apos;migration_test&apos;@&apos;%&apos;;
FLUSH PRIVILEGES;
```

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-09.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 8.0에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

### Character Set 점검
Target DB로 생성되는 Cloud DB for MySQL은 [**utf8, utf8mb4, euckr**] Character Set만 지원합니다.  
Source DB에 이 외의 설정으로 되어 있다면 Character Set을 변경 후 마이그레이션을 진행해야 합니다.

- Character Set 점검 쿼리  

``` sql
SELECT character_set_name
FROM information_schema.TABLES T, information_schema.COLLATION_CHARACTER_SET_APPLICABILITY CCSA
WHERE CCSA.collation_name = T.table_collation 
AND TABLE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND CCSA.character_set_name NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos; );

SELECT DEFAULT_CHARACTER_SET_NAME
FROM information_schema.SCHEMATA T
WHERE SCHEMA_NAME NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND DEFAULT_CHARACTER_SET_NAME NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos;);
```

- Character Set 변경 쿼리 예시 

``` sql
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8mb4;
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE [테이블명] CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```

### 바이너리 로그 설정 {#log_bin}
Source DB의 바이너리 로그 설정 중에서, [**server_id**] 값이 설정되어 있는지와 [**log_bin**]이 ON 상태로 설정되어 있지 확인 후 설정되어 있지 않다면 설정 후에 진행해야 합니다.

#### 현재 설정 확인  
아래 쿼리를 사용해 현재 설정 값을 확인합니다.  

``` sql
show variables like &apos;server_id&apos;;
show variables like &apos;log_bin&apos;;
```

- MySQL 8.0 부터는 기본적으로 설정이 되어 있으므로, 보통의 경우 특별한 조치 없이 그대로 진행하면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-02.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 8.0에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## Target DB 사전 설정
위에서 [Source DB]의 사전 설정이 끝났으므로 이제 [**Target DB**]의 사전 설정이 필요한 항목을 확인해보겠습니다.

### DEFINER 계정 확인 {#DEFINER}
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재한다면 이 때 사용된 DB User 즉, [**DEFINER**] 계정을 [**Target DB**]에도 미리 추가 생성해 두어야 마이그레이션을 진행할 수 있습니다.

아래 쿼리는 [**Procedure**], [**Function**], [**VIEW**] 등을 생성할 때 사용된 [**DEFINER**] 계정을 확인하는 쿼리입니다.  

``` sql
SELECT DEFINER FROM information_schema.ROUTINES
WHERE ROUTINE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos;;

SELECT DEFINER FROM information_schema.VIEWS
WHERE table_schema NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos; ;
```

- 위에서 [**Source DB**]에 테스트 환경을 설정하면서 [**Procedure**]를 하나 생성했었는데 그때 사용된 [**DEFINER**] 계정을 확인할 수 있었습니다. 여기서 확인된 DB User를 [**Target DB**]에 미리 추가 생성해 두어야 합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-22.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-top-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;3&quot; content=&quot;위 단계에서 DEFINER User가 없는 것으로 확인될 경우 DEFINER User 추가 없이 다음 단계로 진행하셔도 됩니다.&quot; %}

### DEFINER 계정 추가
[**Target DB**]를 선택하고 [**DB 관리**] - [**DB User 관리**] 메뉴를 선택합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-06.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- DB User 관리 화면에서 위에서 확인했던 [**DEFINER**] 계정을 DDL 권한으로 설정해서 추가하고 저장합니다. 
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-24.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 접근 권한 설정 {#ACG}
[**Source DB**], [**Target DB**] 양쪽의 사전 설정을 모두 완료했으면, 다음으로는 양쪽 DB간의 접근 권한을 설정해야 합니다.  
앞에서도 설명했지만 마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하게 됩니다.

### NAT Gateway 생성
현재 [**Target DB**]는 [**Private**] 네트워크 환경에 위치해 있으므로 [**Source DB**]로 접근하기 위해서는 [**NAT Gateway**]를 생성해서 외부 통신이 가능하도록 해야 합니다.  
여기서는 [**NAT Gateway**]가 생성되어 있다고 가정하고, 어떻게 설정하는지 확인해보겠습니다.  

- [**NAT Gateway**] 상세 정보 중에서 [**공인 IP**]는 따로 기록해 두었다가, 아래쪽에서 [**방화벽(ACG) 설정**]에서 사용하게 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-15.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

VPC 환경에서 [**NAT Gateway**]를 생성하는 상세한 방법은 아래 문서를 참고하시면 됩니다.

{% include callout-v2.html type=&quot;info&quot; level=&quot;2&quot; content=&quot;
&amp;#8259; &lt;a href=&apos;/networking/ncloud_networking_natgw_routetb.html&apos; target=&apos;_blank&apos; style=&apos;word-break:break-all;&apos;&gt;VPC 환경에서 NAT Gateway 생성하는 방법&lt;/a&gt;
&quot; %}

### Route Table 설정
다음으로 [**VPC**] - [**Route Table**]에서 [**Target DB**]의 Subnet에 연관된 [**Route Table**]을 선택하고, [**Routes 설정**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-16.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- **Route Table 설정** 화면에서 [**Destination**]에는 [**Source DB**]의 공인 IP를 입력하고, [**Target Type**]은 [**NATGW**], [**Target Name**]은 위에서 생성했던 **NAT Gateway**를 선택하고 [**생성**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-17.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 방화벽(ACG) 설정
**`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하여 DB 데이터를 가져오기 위해 [**Target DB**] 방화벽에서는 [**Outbound**] 규칙을,  [**Source DB**] 방화벽에서는 [**Inbound**] 규칙을 설정해야 합니다.

#### Target DB ACG 설정
우선 [**Target DB**]의 [**Outbound**] 규칙을 설정해보겠습니다. [**Target DB**]를 선택하면 나타나는 DB 상세 정보 화면에서 [**ACG**]를 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-07.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG**] 화면에서 해당 ACG를 선택하고 [**ACG 설정**] 메뉴를 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-08.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG 규칙 설정**] 팝업에서 [**Outbound**] 탭을 선택하고, [**목적지**]에는 [**Source DB**]의 IP 주소, [**허용 포트**]에는 [**Source DB**]의 포트 번호를 입력한 후 [**추가**]-[**적용**] 버튼을 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-09.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


#### Source DB 방화벽 설정
이제 [**Source DB**] 방화벽에 위에서 확인했던 [**NAT Gateway**]의 [**공인 IP**]를 추가해서 [**Taget DB**]가 접근할 수 있도록 설정하겠습니다.

- On Premise 등 Ncloud 외부 서버의 경우 자체 방화벽에 직접 추가하시면 됩니다.  

- Ncloud 내부 서버의 경우 해당 서버의 ACG의 [**Inbound**] 설정에 아래처럼 추가하면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-18.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 서비스 위치
이제 모든 준비를 마쳤으면 본격적으로 마이그레이션 작업을 진행해보겠습니다.  
[**Database Migration**] 서비스는 [**Services**] - [**Database**] - [**Database Migration**]에 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-19.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 설정
[**Source DB**]와 [**Target DB**]에서 사전 준비가 끝났으면 이제 [**Database Migration Service**] 설정을 시작합니다.

### Endpoint 설정 {#Endpoint}
우선 [**Database Migration Service**] - [**Endpoint Management**] 메뉴에서 [**Endpoint 생성**] 버튼을 클릭합니다.  
여기서 [**Endpoint**]는 [**Source DB**]를 지칭하는 것으로 [**Source DB**]의 정보를 입력한다고 생각하시면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-20.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

다음으로 Endpoint 생성화면에서 [**Source DB**] 관련 정보를 입력하고 [**생성**] 버튼을 클릭합니다.
- **Endpoint URL**: **Source DB의 IP 또는 도메인**을 입력합니다.
- **DB PORT**: Source DB의 Port를 입력합니다.
- **DB User**: 위에서 Source DB에 생성했던 **마이그레이션 전용 DB User**를 입력합니다.
- **DB Password**: 마이그레이션 전용 DB User의 패스워드를 입력합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-21.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 작업 생성
[**Database Migration Service**] - [**Migration Management**] 메뉴에서 [**Migration 작업생성**] 버튼을 클릭합니다. 

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-25.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Test Connection
[**Source DB**] 항목과 [**Target DB**] 항목을 선택한 후에 [**Test Connection**] 버튼을 클릭해 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**을 테스트 해봅니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-26.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 시작
[**Test Connection**]에서 이상이 없을 경우 아래와 같이 옮겨오게 될 [**Source DB**]의 정보를 확인할 수 있습니다. 문제가 없으면 [**Migration 작업시작**] 버튼을 클릭해서 마이그레이션 작업을 시작합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-03.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 진행 상태
마이그레이션 작업은 [**Exporting**], [**Importing**], [**Replication**] 이렇게 3가지 단계로 진행되는데, 각각의 진행 상태를 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-04.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-05.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 진행 상태 확인 메일
진행 상태는 콘솔에서도 확인할 수 있지만, 작업이 오래 걸리는 경우도 대비해서 각 단계가 완료될 때마다 안내 메일이 발송됩니다.

{% tabs migration-status %}

{% tab migration-status Export Completed %}

&amp;#8259; **Export Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-30.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Import Completed %}

&amp;#8259; **Import Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-31.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Migration Completed %}

&amp;#8259; **Migration Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-32.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;
이 단계까지 완료되면 현재 상태는 **Source DB**와 **Target DB**간의 **Replication**이 완료된 상태이므로 이때 서비스 점검을 시작하고 아래쪽의 마이그레이션 **완료** 버튼을 클릭해서 최종 완료를 확인한 후에 서비스 점검을 종료하면 되겠습니다. 
&quot; %}

## 마이그레이션 완료
마이그레이션 작업이 완료되면 아래와 같이 콘솔화면에서 [**완료**] 버튼이 활성화 됩니다. 즉, 현재는 [**Replication**] 작업이 완료된 상태로 [**Source DB**]와 [**Target DB**]가 동기화 되어 있고, [**Target DB**]는 [**쓰기 불가**] 상태입니다.  

그러므로 [**완료**] 버튼 클릭해야 모든 작업이 완료되고, [**Target DB**]가 [**쓰기 가능**] 상태로 변경됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-06.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**완료**] 버튼 클릭하면 아래와 같이 안내 메시지가 출력되고 [**확인**] 버튼을 클릭하면 완료됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-34.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 최종 완료
최종 완료가 되면 아래와 같이 [**Migration Status**] 상태가 **완료**상태로 변경되고 [**Migration 종료 일시**]로 기록됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-07.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## Target DB 데이터 확인
마이그레이션이 모두 완료되었으므로 [**Source DB**]의 데이터가 [**Target DB**]로 모두 이상 없이 마이그레이션 되었는지 [**Target DB**]에 접속해서 직접 확인해보겠습니다.  
확인해보는 방법은 [**Target DB**]와 동일한 [**Subnet**]에 테스터 서버를 생성하고,  [**Target DB**]에 접속해서 [**Database**], [**Table**], [**Procedure**] 등이 정상적으로 존재하는지 살펴보는 것인데, 아래 스샷처럼 모두 이상이 없는 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-40.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## 오류 상황
지금부터는 마이그레이션 진행 중에 나타날 수 있는 오류 메시지 관련해서 정리해보고, 해결 방법을 알아보겠습니다.

### 방화벽 설정 오류  
[**Source DB**]의 방화벽 Inbound 설정과 [**Target DB**]의 ACG Outbound 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [접근 권한 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#ACG) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 와 Target DB 서버 통신이 되지 않습니다. &lt;br/&gt;Source DB Inbound 와 Target DB Outbound ACG 를 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-36.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Endpoint DB User 설정 오류  
[**Endpoint 설정**]에서 [**DB User**] 또는 [**DB Password**] 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [Endpoint 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#Endpoint) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 에 접속이 되지 않습니다.&lt;br /&gt;DB ACL 을 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-37.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### DEFINER 계정 생성 오류
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재하고, 이때 사용된 DB User 즉, [**DEFINER**] 계정이 [**Target DB**]에 존재하지 않았을 경우 나타나는 메시지 입니다. [DEFINER 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#DEFINER) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB에 생성된 Definer 계정이 Target DB 에 존재하지 않습니다.&lt;br /&gt;Definer 에 사용된 계정은 먼저 생성후 진행해 주세요.&lt;br /&gt;필요 Definer 계정 : abcd2@%&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-38.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 재실행
그 외의 오류로 마이그레이션 작업이 실패했을 경우 아래와 같이 [**재시작**], [**삭제**] 버튼이 활성화 되는데, [**재시작**] 버튼으로 재시작을 할 경우에는 동일한 오류가 계속 발생하는 경우가 있습니다.   
이때는 마이그레이션 작업을 삭제하고, [**Target DB**]에 생성된 [**Database**]을 모두 삭제 후에 마이그레이션 작업을 다시 생성해야 정상 작동합니다.

- [**삭제**] 버튼을 클릭해서 마이그레이션 작업을 삭제합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql80-to-mysql80-guide-10.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 8.0에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**Target DB**]의 [**DB 관리**] - [**DB Server 상세보기**] 메뉴를 클릭해서 [**Database 관리**] 기능으로 이동합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-16.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**Database 관리**]에서 [**Source DB**]에서 Import한 [**Database**]을 모두 삭제하고, [**저장**] 버튼을 클릭합니다.  
그런 후에 마이그레이션 작업을 다시 생성해야 정상 작동합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-15.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 참고 URL
1. Database Migration Service 개요
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/ko/dms-overview&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/ko/dms-overview&lt;/a&gt;

2. Source DB 및 Target DB 접속 설정
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/dms-connect&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/dms-connect&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}  
</description>
            <pubDate>Thu, 26 Oct 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mysql80-to-mysql80-guide.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mysql80-to-mysql80-guide.html</guid>
            
            <category>database</category>
            
            <category>vpc</category>
            
            <category>MySQL</category>
            
            
        </item>
        
        <item>
            <title>Ncloud 데이터베이스 마이그레이션 서비스 | From MySQL 5.7 To MySQL 8.0</title>
            <description>## 개요
Ncloud(네이버 클라우드)의 Database Migration Service는 다양한 환경의 데이터베이스를 클라우드 환경으로 손쉽게 마이그레이션하도록 도와주는 서비스로 여기서는 **Public** 환경의 MySQL 5.7을 **Private** 환경의 [**Cloud DB for MySQL 8.0**]으로 마이그레이션하는 방법에 대해 정리해보겠습니다.

## 서비스에서 제공하는 기능
- **마이그레이션의 단계별 작업 자동화**: Migration 작업을 생성하여 마이그레이션에 필요한 단계별 작업 자동화
- **Endpoint 관리 기능**: 손쉽게 Source DB Endpoint 생성 및 관리 가능
- **연결 테스트 기능**: 마이그레이션 실행 전 Source DB와 Target DB 간 연결 테스트 진행
- **마이그레이션 작업 내역 모니터링**: 마이그레이션 작업 상태와 내역 조회 가능

## 지원 데이터베이스
Database Migration Service는 MySQL 데이터베이스 간 마이그레이션을 지원합니다.

- Major 버전이 동일한 데이터베이스 간의 마이그레이션이 권장됩니다.
- Source DB는 MariaDB도 가능합니다.
- Target DB는 MySQL만 가능합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-41.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 상세 설정 지원 여부
Source DB의 상세 설정에 따른 지원 여부는 다음과 같습니다.

### 지원 항목
- 데이터베이스, TABLE의 캐릭터셋(CharacterSet): euckr, utf8(utf8mb3), utf8mb4 지원
- Table, View, Stored Procedure, Function, Trigger 마이그레이션 지원

### 미지원 항목
- TABLE ENGINE: MyISAM, BLACKHOLE, FEDERATED, ARCHIVE 미지원
- 사용자 계정 정보, MySQL Config 항목, Event 마이그레이션 미지원

## 마이그레이션 진행 구조
마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근하여 DB 데이터를 가져오는 방식`**으로 진행됩니다.   

또한 작업 진행 단계는 다음과 같습니다.
1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 완료 상태
4. 마이그레이션 작업 완료

## 서비스 점검
마이그레이션 작업을 진행할 때 서비스 점검을 언제할 것인가가 중요한 고려사항이 됩니다. 물론 가장 안전한 방법은 마이그레이션 작업 전에 서비스 점검을 시작하는 것이지만, DB의 용량이 클 경우는 [**Export**], [**Import**] 각각 몇 시간씩 소요될 수 있는데, 오랜 시간 서비스 점검을 하려면 부담이 될 수 밖에 없습니다.  
그러므로 오랜 시간 동안 서비스 점검을 하기 어려울 경우 다음과 같이 진행하면 되겠습니다.  

마이그레이션에서 [**Export**], [**Import**] 작업이 끝나면 두 DB간의 **Replication** 상태가 유지되는데 이때는 [**Source DB**]에 새로운 데이터가 추가되면 자동으로 [**Target DB**]로 복제가 됩니다. 그러므로 두 DB 간의 **Replication**이 완료 상태에서 서비스 점검을 시작하고 최종 마이그레이션 작업이 완료된 후에 서비스 점검을 종료하면 됩니다. 

1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 상태
4. 서비스 점검 시작
5. 마이그레이션 작업 완료
6. 서비스 점검 종료

## 테스트 환경
Source DB는 Ncloud(네이버 클라우드) 외부에 위치한 경우가 많을 것으로 예상되므로 다음과 같은 사항들을 가정하고 테스트 환경을 준비해보겠습니다.

- **Source DB**와 **Target DB**가 사설 네트워크로 접근이 불가능한 **서로 다른 네트워크 환경**에 존재한다.
- **Source DB**는 외부에서 공인 IP로 접근 가능한 **Public 네트워크 환경**에 존재한다.
- **Target DB**는 외부에서 접근이 불가능한 **Private 네트워크 환경**에 존재한다.
- **Target DB**는 `NAT Gateway`를 통해서 **Source DB**에 접근한다.

### DB 버전 정보
- Source DB: CentOS 7.8, MySQL 5.7.43
- Target DB: Cloud DB for MySQL 8.0.32

{% tabs db-verstion %}

{% tab db-verstion Source DB %}

&amp;#8259; **Source DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-00.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab db-verstion Target DB %}

&amp;#8259; **Target DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-06.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

### Source DB 정보 확인
테스트에 사용할 Source DB의 버전, Database, DB User 등의 정보를 확인해보겠습니다.

{% tabs sourcedb-setting %}

{% tab sourcedb-setting MySQL 버전 %}

&amp;#8259; **MySQL 버전**  
테스트에 사용할 DB는 아래에서 확인할 수 있듯이 MySQL 5.7.43입니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-01.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Database %}

&amp;#8259; **Database**  
테스트를 위해 testdb1, testdb2 이렇게 2개의 DB를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-02.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting 계정 %}

&amp;#8259; **계정**  
테스트를 위한 abcd1, abcd2 이렇게 2개의 DB User를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-03.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Table %}

&amp;#8259; **Table**  
테스트용 Database에 sampletable1, sampletable2 이렇게 각각 테이블을 1개씩 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-04.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Procedure %}

&amp;#8259; **Procedure**  
테스트용 Database testdb2에 new_procedure2라는 이름의 Procedure를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-05.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

## Source DB 사전 설정

### 마이그레이션 전용 DB User 생성
마이그레이션을 위한 전용 유저 즉, Target DB에서 Source DB로 접속할 때 사용할 DB User를 아래와 같이 생성합니다.

- 패스워드는 최소 8자 이상, 최대 21 자까지만 입력이 가능합니다.  
영문 / 특수문자 / 숫자가 포함되어야 합니다.  
` &amp; + \ &quot; &apos; / 스페이스 는 패스워드로 사용할 수 없습니다.  
- 기본 시스템DB를 제외한 사용자가 추가로 생성한 모든 데이터베이스에 대해 권한을 부여합니다.

``` sql
CREATE USER &apos;migration_test&apos;@&apos;%&apos; IDENTIFIED WITH &apos;mysql_native_password&apos;  BY &apos;[패스워드]&apos;;
GRANT RELOAD, PROCESS, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT ON mysql.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT, SHOW VIEW, LOCK TABLES, TRIGGER ON [사용자 생성 DB].* TO &apos;migration_test&apos;@&apos;%&apos;;
FLUSH PRIVILEGES;
```

- 위쪽에서 Source DB에 테스용으로 [**testdb1**], [**testdb2**] 이렇게 2개를 데이터베이스가 존재하므로 두 개의 데이터베이스 각각에 대해 권한을 부여했습니다.
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-10.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Character Set 점검
Target DB로 생성되는 Cloud DB for MySQL은 [**utf8, utf8mb4, euckr**] Character Set만 지원합니다.  
Source DB에 이 외의 설정으로 되어 있다면 Character Set을 변경 후 마이그레이션을 진행해야 합니다.

- Character Set 점검 쿼리  

``` sql
SELECT character_set_name
FROM information_schema.TABLES T, information_schema.COLLATION_CHARACTER_SET_APPLICABILITY CCSA
WHERE CCSA.collation_name = T.table_collation 
AND TABLE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND CCSA.character_set_name NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos; );

SELECT DEFAULT_CHARACTER_SET_NAME
FROM information_schema.SCHEMATA T
WHERE SCHEMA_NAME NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND DEFAULT_CHARACTER_SET_NAME NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos;);
```

- Character Set 변경 쿼리 예시 

``` sql
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8;
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8 COLLATE utf8_general_ci;
ALTER TABLE [테이블명] CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci;
```

### sql_mode 설정 점검 {#sql_mode}
MySQL 5.7 버전에서 Default 값으로 지원하는 sql_mode=&apos;NO_AUTO_CREATE_USER&apos; 설정은 MySQL 8.0 버전부터는 지원하지 않기 때문에, Source DB에서 사용된 곳이 있으면 찾아서 해당 옵션을 제거해야 합니다.

#### sql_mode 설정 점검 쿼리
Procedure, Function 등의 ROUTINE과 TRIGGER에서 사용되므로 아래 쿼리로 [**NO_AUTO_CREATE_USER**] 옵션이 사용된 곳이 있는지 점검합니다.

``` sql
SELECT ROUTINE_SCHEMA, ROUTINE_NAME, SQL_MODE
FROM information_schema.routines
WHERE ROUTINE_SCHEMA NOT IN (&apos;sys&apos;,&apos;mysql&apos;);

SELECT TRIGGER_SCHEMA, TRIGGER_NAME, sql_mode
FROM information_schema.triggers
WHERE TRIGGER_SCHEMA NOT IN (&apos;sys&apos;,&apos;mysql&apos;);
```

- 테스트용 Source DB에서 점검 쿼리를 실행해보면 아래와 같이 [**testdb2**]의 [**new_procedure2**]에 [**NO_AUTO_CREATE_USER**] 옵션이 적용되어 있는 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-01.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### sql_mode 호환성 이슈 조치 방법
Procedure, Function, Trigger의 Dump 파일을 생성하고 [**NO_AUTO_CREATE_USER**] 옵션을 제거한 후 다시 적용하면 됩니다.

- Procedure, Function, Trigger 에 대해서만 drop 및 create 구문이 생성된 sql 파일 생성  

``` bash
~# mysqldump -u {사용자명} -p --set-gtid-purged=OFF --routines --triggers  --no-create-info --no-data --no-create-db --add-drop-trigger --databases {사용자 DB} &gt; backup.sql
```
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-02.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- backup.sql 파일내 NO_AUTO_CREATE_USER 구문 모두 제거  
해당 옵션을 일일이 찾아서 제거하기 힘드니 vim 에디터에서 [**NO_AUTO_CREATE_USER**] 문자를 찾아서 제거하는 명령을 실행합니다.  
경우에 따라서는 Dump 파일에 [**NO_AUTO_CREATE_USER**] 옵션이 포함되지 않는 경우도 있습니다. 이때는 걱정말고 Dump 파일을 그냥 그대로 적용하면 됩니다.

``` bash   
vim 명령: %s /NO_AUTO_CREATE_USER,//g

원본 예시: SET sql_mode = &apos;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&apos;  
수정 예시: SET sql_mode = &apos;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION&apos;
```
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-03.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- 적용하기  
수정된 Dump 파일을 Source DB에 적용합니다.

``` bash
~# mysql -u {사용자명} -p {사용자 DB} &lt; backup.sql
```
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-04.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### sql_mode 설정 변경 확인
설정이 제대로 변경되었는지 점검 쿼리로 다시 확인해보겠습니다.

``` sql
SELECT ROUTINE_SCHEMA, ROUTINE_NAME, SQL_MODE
FROM information_schema.routines
WHERE ROUTINE_SCHEMA NOT IN (&apos;sys&apos;,&apos;mysql&apos;);
```

- 아래 스샷처럼 [**NO_AUTO_CREATE_USER**] 옵션이 사라진 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-05.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


### 바이너리 로그 설정 {#log_bin}
Source DB의 바이너리 로그 설정 중에서, [**server_id**] 값이 설정되어 있는지와 [**log_bin**]이 ON 상태로 설정되어 있지 확인 후 설정되어 있지 않다면 설정 후에 진행해야 합니다.

#### 현재 설정 확인  
아래 쿼리를 사용해 현재 설정 값을 확인합니다.  

``` sql
show variables like &apos;server_id&apos;;
show variables like &apos;log_bin&apos;;
```

- 현재 테스트용 Source DB는 두 값이 모두 설정되어 있지 않은 상태입니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-11.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 설정 변경
MySQL의 환경 설정 파일 [**my.cnf**]를 열어서 아래 값을 추가하고, MySQL 데몬을 재시작합니다.
``` bash
~# vim /etc/my.cnf

server_id = 1
log_bin = binlog

~# systemctl restart mysqld
```

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-12.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-13.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 변경 설정 확인  
설정 변경 후에 확인해보면 아래와 같이 [**server_id**] 값이 설정되어 있고, [**log_bin**]이 ON 상태로 변경된 것을 알 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-14.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## Target DB 사전 설정
위에서 [Source DB]의 사전 설정이 끝났으므로 이제 [**Target DB**]의 사전 설정이 필요한 항목을 확인해보겠습니다.

### DEFINER 계정 확인 {#DEFINER}
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재한다면 이 때 사용된 DB User 즉, [**DEFINER**] 계정을 [**Target DB**]에도 미리 추가 생성해 두어야 마이그레이션을 진행할 수 있습니다.

아래 쿼리는 [**Procedure**], [**Function**], [**VIEW**] 등을 생성할 때 사용된 [**DEFINER**] 계정을 확인하는 쿼리입니다.  

``` sql
SELECT DEFINER FROM information_schema.ROUTINES
WHERE ROUTINE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos;;

SELECT DEFINER FROM information_schema.VIEWS
WHERE table_schema NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos; ;
```

- 위에서 [**Source DB**]에 테스트 환경을 설정하면서 [**Procedure**]를 하나 생성했었는데 그때 사용된 [**DEFINER**] 계정을 확인할 수 있었습니다. 여기서 확인된 DB User를 [**Target DB**]에 미리 추가 생성해 두어야 합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-22.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-top-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;3&quot; content=&quot;위 단계에서 DEFINER User가 없는 것으로 확인될 경우 DEFINER User 추가 없이 다음 단계로 진행하셔도 됩니다.&quot; %}

### DEFINER 계정 추가
[**Target DB**]를 선택하고 [**DB 관리**] - [**DB User 관리**] 메뉴를 선택합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-06.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- DB User 관리 화면에서 위에서 확인했던 [**DEFINER**] 계정을 DDL 권한으로 설정해서 추가하고 저장합니다. 
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-24.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 접근 권한 설정 {#ACG}
[**Source DB**], [**Target DB**] 양쪽의 사전 설정을 모두 완료했으면, 다음으로는 양쪽 DB간의 접근 권한을 설정해야 합니다.  
앞에서도 설명했지만 마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하게 됩니다.

### NAT Gateway 생성
현재 [**Target DB**]는 [**Private**] 네트워크 환경에 위치해 있으므로 [**Source DB**]로 접근하기 위해서는 [**NAT Gateway**]를 생성해서 외부 통신이 가능하도록 해야 합니다.  
여기서는 [**NAT Gateway**]가 생성되어 있다고 가정하고, 어떻게 설정하는지 확인해보겠습니다.  

- [**NAT Gateway**] 상세 정보 중에서 [**공인 IP**]는 따로 기록해 두었다가, 아래쪽에서 [**방화벽(ACG) 설정**]에서 사용하게 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-15.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

VPC 환경에서 [**NAT Gateway**]를 생성하는 상세한 방법은 아래 문서를 참고하시면 됩니다.

{% include callout-v2.html type=&quot;info&quot; level=&quot;2&quot; content=&quot;
&amp;#8259; &lt;a href=&apos;/networking/ncloud_networking_natgw_routetb.html&apos; target=&apos;_blank&apos; style=&apos;word-break:break-all;&apos;&gt;VPC 환경에서 NAT Gateway 생성하는 방법&lt;/a&gt;
&quot; %}

### Route Table 설정
다음으로 [**VPC**] - [**Route Table**]에서 [**Target DB**]의 Subnet에 연관된 [**Route Table**]을 선택하고, [**Routes 설정**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-16.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- **Route Table 설정** 화면에서 [**Destination**]에는 [**Source DB**]의 공인 IP를 입력하고, [**Target Type**]은 [**NATGW**], [**Target Name**]은 위에서 생성했던 **NAT Gateway**를 선택하고 [**생성**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-17.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 방화벽(ACG) 설정
**`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하여 DB 데이터를 가져오기 위해 [**Target DB**] 방화벽에서는 [**Outbound**] 규칙을,  [**Source DB**] 방화벽에서는 [**Inbound**] 규칙을 설정해야 합니다.

#### Target DB ACG 설정
우선 [**Target DB**]의 [**Outbound**] 규칙을 설정해보겠습니다. [**Target DB**]를 선택하면 나타나는 DB 상세 정보 화면에서 [**ACG**]를 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-07.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG**] 화면에서 해당 ACG를 선택하고 [**ACG 설정**] 메뉴를 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-08.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG 규칙 설정**] 팝업에서 [**Outbound**] 탭을 선택하고, [**목적지**]에는 [**Source DB**]의 IP 주소, [**허용 포트**]에는 [**Source DB**]의 포트 번호를 입력한 후 [**추가**]-[**적용**] 버튼을 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-09.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


#### Source DB 방화벽 설정
이제 [**Source DB**] 방화벽에 위에서 확인했던 [**NAT Gateway**]의 [**공인 IP**]를 추가해서 [**Taget DB**]가 접근할 수 있도록 설정하겠습니다.

- On Premise 등 Ncloud 외부 서버의 경우 자체 방화벽에 직접 추가하시면 됩니다.  

- Ncloud 내부 서버의 경우 해당 서버의 ACG의 [**Inbound**] 설정에 아래처럼 추가하면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-18.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 서비스 위치
이제 모든 준비를 마쳤으면 본격적으로 마이그레이션 작업을 진행해보겠습니다.  
[**Database Migration**] 서비스는 [**Services**] - [**Database**] - [**Database Migration**]에 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-19.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 설정
[**Source DB**]와 [**Target DB**]에서 사전 준비가 끝났으면 이제 [**Database Migration Service**] 설정을 시작합니다.

### Endpoint 설정 {#Endpoint}
우선 [**Database Migration Service**] - [**Endpoint Management**] 메뉴에서 [**Endpoint 생성**] 버튼을 클릭합니다.  
여기서 [**Endpoint**]는 [**Source DB**]를 지칭하는 것으로 [**Source DB**]의 정보를 입력한다고 생각하시면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-20.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

다음으로 Endpoint 생성화면에서 [**Source DB**] 관련 정보를 입력하고 [**생성**] 버튼을 클릭합니다.
- **Endpoint URL**: **Source DB의 IP 또는 도메인**을 입력합니다.
- **DB PORT**: Source DB의 Port를 입력합니다.
- **DB User**: 위에서 Source DB에 생성했던 **마이그레이션 전용 DB User**를 입력합니다.
- **DB Password**: 마이그레이션 전용 DB User의 패스워드를 입력합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-21.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 작업 생성
[**Database Migration Service**] - [**Migration Management**] 메뉴에서 [**Migration 작업생성**] 버튼을 클릭합니다. 

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-25.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Test Connection
[**Source DB**] 항목과 [**Target DB**] 항목을 선택한 후에 [**Test Connection**] 버튼을 클릭해 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**을 테스트 해봅니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-26.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 시작
[**Test Connection**]에서 이상이 없을 경우 아래와 같이 옮겨오게 될 [**Source DB**]의 정보를 확인할 수 있습니다. 문제가 없으면 [**Migration 작업시작**] 버튼을 클릭해서 마이그레이션 작업을 시작합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-27.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 진행 상태
마이그레이션 작업은 [**Exporting**], [**Importing**], [**Replication**] 이렇게 3가지 단계로 진행되는데, 각각의 진행 상태를 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-08.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-09.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 진행 상태 확인 메일
진행 상태는 콘솔에서도 확인할 수 있지만, 작업이 오래 걸리는 경우도 대비해서 각 단계가 완료될 때마다 안내 메일이 발송됩니다.

{% tabs migration-status %}

{% tab migration-status Export Completed %}

&amp;#8259; **Export Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-30.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Import Completed %}

&amp;#8259; **Import Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-31.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Migration Completed %}

&amp;#8259; **Migration Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-32.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;
이 단계까지 완료되면 현재 상태는 **Source DB**와 **Target DB**간의 **Replication**이 완료된 상태이므로 이때 서비스 점검을 시작하고 아래쪽의 마이그레이션 **완료** 버튼을 클릭해서 최종 완료를 확인한 후에 서비스 점검을 종료하면 되겠습니다. 
&quot; %}

## 마이그레이션 완료
마이그레이션 작업이 완료되면 아래와 같이 콘솔화면에서 [**완료**] 버튼이 활성화 됩니다. 즉, 현재는 [**Replication**] 작업이 완료된 상태로 [**Source DB**]와 [**Target DB**]가 동기화 되어 있고, [**Target DB**]는 [**쓰기 불가**] 상태입니다.  

그러므로 [**완료**] 버튼 클릭해야 모든 작업이 완료되고, [**Target DB**]가 [**쓰기 가능**] 상태로 변경됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-10.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**완료**] 버튼 클릭하면 아래와 같이 안내 메시지가 출력되고 [**확인**] 버튼을 클릭하면 완료됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-34.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 최종 완료
최종 완료가 되면 아래와 같이 [**Migration Status**] 상태가 **완료**상태로 변경되고 [**Migration 종료 일시**]로 기록됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-11.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## Target DB 데이터 확인
마이그레이션이 모두 완료되었으므로 [**Source DB**]의 데이터가 [**Target DB**]로 모두 이상 없이 마이그레이션 되었는지 [**Target DB**]에 접속해서 직접 확인해보겠습니다.  
확인해보는 방법은 [**Target DB**]와 동일한 [**Subnet**]에 테스터 서버를 생성하고,  [**Target DB**]에 접속해서 [**Database**], [**Table**], [**Procedure**] 등이 정상적으로 존재하는지 살펴보는 것인데, 아래 스샷처럼 모두 이상이 없는 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-40.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## 오류 상황
지금부터는 마이그레이션 진행 중에 나타날 수 있는 오류 메시지 관련해서 정리해보고, 해결 방법을 알아보겠습니다.

### 방화벽 설정 오류  
[**Source DB**]의 방화벽 Inbound 설정과 [**Target DB**]의 ACG Outbound 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [접근 권한 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#ACG) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 와 Target DB 서버 통신이 되지 않습니다. &lt;br/&gt;Source DB Inbound 와 Target DB Outbound ACG 를 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-36.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Endpoint DB User 설정 오류  
[**Endpoint 설정**]에서 [**DB User**] 또는 [**DB Password**] 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [Endpoint 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#Endpoint) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 에 접속이 되지 않습니다.&lt;br /&gt;DB ACL 을 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-37.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### DEFINER 계정 생성 오류
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재하고, 이때 사용된 DB User 즉, [**DEFINER**] 계정이 [**Target DB**]에 존재하지 않았을 경우 나타나는 메시지 입니다. [DEFINER 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#DEFINER) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB에 생성된 Definer 계정이 Target DB 에 존재하지 않습니다.&lt;br /&gt;Definer 에 사용된 계정은 먼저 생성후 진행해 주세요.&lt;br /&gt;필요 Definer 계정 : abcd2@%&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-38.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


### 바이너리 로그 설정 오류
Source DB의 바이너리 로그 설정 중에서, [server_id], [log_bin] 관련 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [바이너리 로그 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#log_bin) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;마이그레이션을 위해서는 Source DB Config 설정이 필요합니다.&lt;br /&gt;추가 필요 설정 : log_bin&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-39.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


### sql_mode 설정 오류
[**Source DB**] 사전 설정에서 sql_mode 관련된 설정을 수정하지 않았을 경우 아래와 같이 마이그레이션 진행 중에 [**Importing**] 단계에서 실패가 발생하고 [**에러 보기**] 버튼을 클릭하면 아래와 같은 메시지가 나타납니다. [sql_mode 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#sql_mode) 내용을 다시 확인해주세요.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-12.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;ERROR 1234 (42000) at line 98: Variable &apos;sql_mode&apos; can&apos;t be set to the value of &apos;NO_AUTO_CREATE_USER&apos;&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-13.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 마이그레이션 재실행
위와 같이 [**sql_mode**] 관련 오류로 마이그레이션 작업이 실패했을 경우에는 [**재시작**] 버튼으로 재시작을 할 경우에는 동일한 오류가 계속 발생하게 됩니다.   
이때는 [**sql_mode**] 설정을 수정한 후에 마이그레이션 작업을 삭제하고, [**Target DB**]에 생성된 [**Database**]을 모두 삭제 후에 마이그레이션 작업을 다시 생성해야 정상 작동합니다.

- [**sql_mode**] 설정을 수정한 후에 [**삭제**] 버튼을 클릭해서 마이그레이션 작업을 삭제합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-14.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**Target DB**]의 [**DB 관리**] - [**DB Server 상세보기**] 메뉴를 클릭해서 [**Database 관리**] 기능으로 이동합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-16.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**Database 관리**]에서 [**Source DB**]에서 Import한 [**Database**]을 모두 삭제하고, [**저장**] 버튼을 클릭합니다.  
그런 후에 마이그레이션 작업을 다시 생성해야 정상 작동합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql80-guide-15.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 Cloud DB for MySQL 8.0으로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 참고 URL
1. Database Migration Service 개요
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/ko/dms-overview&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/ko/dms-overview&lt;/a&gt;

2. Source DB 및 Target DB 접속 설정
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/dms-connect&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/dms-connect&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}  
</description>
            <pubDate>Tue, 24 Oct 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mysql57-to-mysql80-guide.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mysql57-to-mysql80-guide.html</guid>
            
            <category>database</category>
            
            <category>vpc</category>
            
            <category>MySQL</category>
            
            
        </item>
        
        <item>
            <title>Ncloud 데이터베이스 마이그레이션 서비스 | From MySQL 5.7 To MySQL 5.7</title>
            <description>## 개요
Ncloud(네이버 클라우드)의 Database Migration Service는 다양한 환경의 데이터베이스를 클라우드 환경으로 손쉽게 마이그레이션하도록 도와주는 서비스로 여기서는 **Public** 환경의 MySQL 5.7을 **Private** 환경의 [**Cloud DB for MySQL 5.7**]로 마이그레이션하는 방법에 대해 정리해보겠습니다.

## 서비스에서 제공하는 기능
- **마이그레이션의 단계별 작업 자동화**: Migration 작업을 생성하여 마이그레이션에 필요한 단계별 작업 자동화
- **Endpoint 관리 기능**: 손쉽게 Source DB Endpoint 생성 및 관리 가능
- **연결 테스트 기능**: 마이그레이션 실행 전 Source DB와 Target DB 간 연결 테스트 진행
- **마이그레이션 작업 내역 모니터링**: 마이그레이션 작업 상태와 내역 조회 가능

## 지원 데이터베이스
Database Migration Service는 MySQL 데이터베이스 간 마이그레이션을 지원합니다.

- Major 버전이 동일한 데이터베이스 간의 마이그레이션이 권장됩니다.
- Source DB는 MariaDB도 가능합니다.
- Target DB는 MySQL만 가능합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-41.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 상세 설정 지원 여부
Source DB의 상세 설정에 따른 지원 여부는 다음과 같습니다.

### 지원 항목
- 데이터베이스, TABLE의 캐릭터셋(CharacterSet): euckr, utf8(utf8mb3), utf8mb4 지원
- Table, View, Stored Procedure, Function, Trigger 마이그레이션 지원

### 미지원 항목
- TABLE ENGINE: MyISAM, BLACKHOLE, FEDERATED, ARCHIVE 미지원
- 사용자 계정 정보, MySQL Config 항목, Event 마이그레이션 미지원

## 마이그레이션 진행 구조
마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근하여 DB 데이터를 가져오는 방식`**으로 진행됩니다.   

또한 작업 진행 단계는 다음과 같습니다.
1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 완료 상태
4. 마이그레이션 작업 완료

## 서비스 점검
마이그레이션 작업을 진행할 때 서비스 점검을 언제할 것인가가 중요한 고려사항이 됩니다. 물론 가장 안전한 방법은 마이그레이션 작업 전에 서비스 점검을 시작하는 것이지만, DB의 용량이 클 경우는 [**Export**], [**Import**] 각각 몇 시간씩 소요될 수 있는데, 오랜 시간 서비스 점검을 하려면 부담이 될 수 밖에 없습니다.  
그러므로 오랜 시간 동안 서비스 점검을 하기 어려울 경우 다음과 같이 진행하면 되겠습니다.  

마이그레이션에서 [**Export**], [**Import**] 작업이 끝나면 두 DB간의 **Replication** 상태가 유지되는데 이때는 [**Source DB**]에 새로운 데이터가 추가되면 자동으로 [**Target DB**]로 복제가 됩니다. 그러므로 두 DB 간의 **Replication**이 완료 상태에서 서비스 점검을 시작하고 최종 마이그레이션 작업이 완료된 후에 서비스 점검을 종료하면 됩니다. 

1. [**Source DB**]에서 [**Export**]
2. [**Target DB**]로 [**Import**]
3. 두 DB 간의 **Replication** 상태
4. 서비스 점검 시작
5. 마이그레이션 작업 완료
6. 서비스 점검 종료

## 테스트 환경
Source DB는 Ncloud(네이버 클라우드) 외부에 위치한 경우가 많을 것으로 예상되므로 다음과 같은 사항들을 가정하고 테스트 환경을 준비해보겠습니다.

- **Source DB**와 **Target DB**가 사설 네트워크로 접근이 불가능한 **서로 다른 네트워크 환경**에 존재한다.
- **Source DB**는 외부에서 공인 IP로 접근 가능한 **Public 네트워크 환경**에 존재한다.
- **Target DB**는 외부에서 접근이 불가능한 **Private 네트워크 환경**에 존재한다.
- **Target DB**는 `NAT Gateway`를 통해서 **Source DB**에 접근한다.

### DB 버전 정보
- Source DB: CentOS 7.8, MySQL 5.7.43
- Target DB: Cloud DB for MySQL 5.7.40

{% tabs db-verstion %}

{% tab db-verstion Source DB %}

&amp;#8259; **Source DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-00.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab db-verstion Target DB %}

&amp;#8259; **Target DB**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-06.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

### Source DB 정보 확인
테스트에 사용할 Source DB의 버전, Database, DB User 등의 정보를 확인해보겠습니다.

{% tabs sourcedb-setting %}

{% tab sourcedb-setting MySQL 버전 %}

&amp;#8259; **MySQL 버전**  
테스트에 사용할 DB는 아래에서 확인할 수 있듯이 MySQL 5.7.43입니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-01.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Database %}

&amp;#8259; **Database**  
테스트를 위해 testdb1, testdb2 이렇게 2개의 DB를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-02.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting 계정 %}

&amp;#8259; **계정**  
테스트를 위한 abcd1, abcd2 이렇게 2개의 DB User를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-03.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Table %}

&amp;#8259; **Table**  
테스트용 Database에 sampletable1, sampletable2 이렇게 각각 테이블을 1개씩 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-04.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab sourcedb-setting Procedure %}

&amp;#8259; **Procedure**  
테스트용 Database testdb2에 new_procedure2라는 이름의 Procedure를 생성했습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-05.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

## Source DB 사전 설정

### 마이그레이션 전용 DB User 생성
마이그레이션을 위한 전용 유저 즉, Target DB에서 Source DB로 접속할 때 사용할 DB User를 아래와 같이 생성합니다.

- 패스워드는 최소 8자 이상, 최대 21 자까지만 입력이 가능합니다.  
영문 / 특수문자 / 숫자가 포함되어야 합니다.  
` &amp; + \ &quot; &apos; / 스페이스 는 패스워드로 사용할 수 없습니다.  
- 기본 시스템DB를 제외한 사용자가 추가로 생성한 모든 데이터베이스에 대해 권한을 부여합니다.

``` sql
CREATE USER &apos;migration_test&apos;@&apos;%&apos; IDENTIFIED WITH &apos;mysql_native_password&apos;  BY &apos;[패스워드]&apos;;
GRANT RELOAD, PROCESS, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT ON mysql.* TO &apos;migration_test&apos;@&apos;%&apos;;
GRANT SELECT, SHOW VIEW, LOCK TABLES, TRIGGER ON [사용자 생성 DB].* TO &apos;migration_test&apos;@&apos;%&apos;;
FLUSH PRIVILEGES;
```

- 위쪽에서 Source DB에 테스용으로 [**testdb1**], [**testdb2**] 이렇게 2개를 데이터베이스가 존재하므로 두 개의 데이터베이스 각각에 대해 권한을 부여했습니다.
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-10.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Character Set 점검
Target DB로 생성되는 Cloud DB for MySQL은 [**utf8, utf8mb4, euckr**] Character Set만 지원합니다.  
Source DB에 이 외의 설정으로 되어 있다면 Character Set을 변경 후 마이그레이션을 진행해야 합니다.

- Character Set 점검 쿼리  

``` sql
SELECT character_set_name
FROM information_schema.TABLES T, information_schema.COLLATION_CHARACTER_SET_APPLICABILITY CCSA
WHERE CCSA.collation_name = T.table_collation 
AND TABLE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND CCSA.character_set_name NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos; );

SELECT DEFAULT_CHARACTER_SET_NAME
FROM information_schema.SCHEMATA T
WHERE SCHEMA_NAME NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) 
AND DEFAULT_CHARACTER_SET_NAME NOT IN ( &apos;utf8&apos;, &apos;utf8mb4&apos;, &apos;euckr&apos;);
```

- Character Set 변경 쿼리 예시 

``` sql
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8;
ALTER DATABASE [데이터베이스명] CHARACTER SET utf8 COLLATE utf8_general_ci;
ALTER TABLE [테이블명] CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci;
```

### 바이너리 로그 설정 {#log_bin}
Source DB의 바이너리 로그 설정 중에서, [**server_id**] 값이 설정되어 있는지와 [**log_bin**]이 ON 상태로 설정되어 있지 확인 후 설정되어 있지 않다면 설정 후에 진행해야 합니다.

#### 현재 설정 확인  
아래 쿼리를 사용해 현재 설정 값을 확인합니다.  

``` sql
show variables like &apos;server_id&apos;;
show variables like &apos;log_bin&apos;;
```

- 현재 테스트용 Source DB는 두 값이 모두 설정되어 있지 않은 상태입니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-11.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 설정 변경
MySQL의 환경 설정 파일 [**my.cnf**]를 열어서 아래 값을 추가하고, MySQL 데몬을 재시작합니다.
``` bash
~# vim /etc/my.cnf

server_id = 1
log_bin = binlog

~# systemctl restart mysqld
```

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-12.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-13.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 변경 설정 확인  
설정 변경 후에 확인해보면 아래와 같이 [**server_id**] 값이 설정되어 있고, [**log_bin**]이 ON 상태로 변경된 것을 알 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-14.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-top&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## Target DB 사전 설정
위에서 [Source DB]의 사전 설정이 끝났으므로 이제 [**Target DB**]의 사전 설정이 필요한 항목을 확인해보겠습니다.

### DEFINER 계정 확인 {#DEFINER}
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재한다면 이 때 사용된 DB User 즉, [**DEFINER**] 계정을 [**Target DB**]에도 미리 추가 생성해 두어야 마이그레이션을 진행할 수 있습니다.

아래 쿼리는 [**Procedure**], [**Function**], [**VIEW**] 등을 생성할 때 사용된 [**DEFINER**] 계정을 확인하는 쿼리입니다.  

``` sql
SELECT DEFINER FROM information_schema.ROUTINES
WHERE ROUTINE_SCHEMA NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos;;

SELECT DEFINER FROM information_schema.VIEWS
WHERE table_schema NOT IN ( &apos;information_schema&apos;, &apos;mysql&apos;, &apos;performance_schema&apos;, &apos;sys&apos; ) AND SECURITY_TYPE = &apos;DEFINER&apos; ;
```

- 위에서 [**Source DB**]에 테스트 환경을 설정하면서 [**Procedure**]를 하나 생성했었는데 그때 사용된 [**DEFINER**] 계정을 확인할 수 있었습니다. 여기서 확인된 DB User를 [**Target DB**]에 미리 추가 생성해 두어야 합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-22.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-top-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;3&quot; content=&quot;위 단계에서 DEFINER User가 없는 것으로 확인될 경우 DEFINER User 추가 없이 다음 단계로 진행하셔도 됩니다.&quot; %}

### DEFINER 계정 추가
[**Target DB**]를 선택하고 [**DB 관리**] - [**DB User 관리**] 메뉴를 선택합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-23.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- DB User 관리 화면에서 위에서 확인했던 [**DEFINER**] 계정을 DDL 권한으로 설정해서 추가하고 저장합니다. 
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-24.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 접근 권한 설정 {#ACG}
[**Source DB**], [**Target DB**] 양쪽의 사전 설정을 모두 완료했으면, 다음으로는 양쪽 DB간의 접근 권한을 설정해야 합니다.  
앞에서도 설명했지만 마이그레이션은 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하게 됩니다.

### NAT Gateway 생성
현재 [**Target DB**]는 [**Private**] 네트워크 환경에 위치해 있으므로 [**Source DB**]로 접근하기 위해서는 [**NAT Gateway**]를 생성해서 외부 통신이 가능하도록 해야 합니다.  
여기서는 [**NAT Gateway**]가 생성되어 있다고 가정하고, 어떻게 설정하는지 확인해보겠습니다.  

- [**NAT Gateway**] 상세 정보 중에서 [**공인 IP**]는 따로 기록해 두었다가, 아래쪽에서 [**방화벽(ACG) 설정**]에서 사용하게 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-15.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

VPC 환경에서 [**NAT Gateway**]를 생성하는 상세한 방법은 아래 문서를 참고하시면 됩니다.

{% include callout-v2.html type=&quot;info&quot; level=&quot;2&quot; content=&quot;
&amp;#8259; &lt;a href=&apos;/networking/ncloud_networking_natgw_routetb.html&apos; target=&apos;_blank&apos; style=&apos;word-break:break-all;&apos;&gt;VPC 환경에서 NAT Gateway 생성하는 방법&lt;/a&gt;
&quot; %}

### Route Table 설정
다음으로 [**VPC**] - [**Route Table**]에서 [**Target DB**]의 Subnet에 연관된 [**Route Table**]을 선택하고, [**Routes 설정**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-16.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- **Route Table 설정** 화면에서 [**Destination**]에는 [**Source DB**]의 공인 IP를 입력하고, [**Target Type**]은 [**NATGW**], [**Target Name**]은 위에서 생성했던 **NAT Gateway**를 선택하고 [**생성**] 버튼을 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-17.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 방화벽(ACG) 설정
**`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**하여 DB 데이터를 가져오기 위해 [**Target DB**] 방화벽에서는 [**Outbound**] 규칙을,  [**Source DB**] 방화벽에서는 [**Inbound**] 규칙을 설정해야 합니다.

#### Target DB ACG 설정
우선 [**Target DB**]의 [**Outbound**] 규칙을 설정해보겠습니다. [**Target DB**]를 선택하면 나타나는 DB 상세 정보 화면에서 [**ACG**]를 클릭합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-07.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG**] 화면에서 해당 ACG를 선택하고 [**ACG 설정**] 메뉴를 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-08.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**ACG 규칙 설정**] 팝업에서 [**Outbound**] 탭을 선택하고, [**목적지**]에는 [**Source DB**]의 IP 주소, [**허용 포트**]에는 [**Source DB**]의 포트 번호를 입력한 후 [**추가**]-[**적용**] 버튼을 클릭합니다.  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-09.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


#### Source DB 방화벽 설정
이제 [**Source DB**] 방화벽에 위에서 확인했던 [**NAT Gateway**]의 [**공인 IP**]를 추가해서 [**Taget DB**]가 접근할 수 있도록 설정하겠습니다.

- On Premise 등 Ncloud 외부 서버의 경우 자체 방화벽에 직접 추가하시면 됩니다.  

- Ncloud 내부 서버의 경우 해당 서버의 ACG의 [**Inbound**] 설정에 아래처럼 추가하면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-18.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 서비스 위치
이제 모든 준비를 마쳤으면 본격적으로 마이그레이션 작업을 진행해보겠습니다.  
[**Database Migration**] 서비스는 [**Services**] - [**Database**] - [**Database Migration**]에 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-19.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 설정
[**Source DB**]와 [**Target DB**]에서 사전 준비가 끝났으면 이제 [**Database Migration Service**] 설정을 시작합니다.

### Endpoint 설정 {#Endpoint}
우선 [**Database Migration Service**] - [**Endpoint Management**] 메뉴에서 [**Endpoint 생성**] 버튼을 클릭합니다.  
여기서 [**Endpoint**]는 [**Source DB**]를 지칭하는 것으로 [**Source DB**]의 정보를 입력한다고 생각하시면 됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-20.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

다음으로 Endpoint 생성화면에서 [**Source DB**] 관련 정보를 입력하고 [**생성**] 버튼을 클릭합니다.
- **Endpoint URL**: **Source DB의 IP 또는 도메인**을 입력합니다.
- **DB PORT**: Source DB의 Port를 입력합니다.
- **DB User**: 위에서 Source DB에 생성했던 **마이그레이션 전용 DB User**를 입력합니다.
- **DB Password**: 마이그레이션 전용 DB User의 패스워드를 입력합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-21.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

## 마이그레이션 작업 생성
[**Database Migration Service**] - [**Migration Management**] 메뉴에서 [**Migration 작업생성**] 버튼을 클릭합니다. 

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-25.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Test Connection
[**Source DB**] 항목과 [**Target DB**] 항목을 선택한 후에 [**Test Connection**] 버튼을 클릭해 **`Target DB`**&lt;i class=&quot;fa-solid fa-right-long&quot; style=&quot;color: #e43b11;&quot;&gt;&lt;/i&gt; **`Source DB로 접근`**을 테스트 해봅니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-26.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 시작
[**Test Connection**]에서 이상이 없을 경우 아래와 같이 옮겨오게 될 [**Source DB**]의 정보를 확인할 수 있습니다. 문제가 없으면 [**Migration 작업시작**] 버튼을 클릭해서 마이그레이션 작업을 시작합니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-27.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 마이그레이션 작업 진행 상태
마이그레이션 작업은 [**Exporting**], [**Importing**], [**Replication**] 이렇게 3가지 단계로 진행되는데, 각각의 진행 상태를 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-28.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-29.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

#### 진행 상태 확인 메일
진행 상태는 콘솔에서도 확인할 수 있지만, 작업이 오래 걸리는 경우도 대비해서 각 단계가 완료될 때마다 안내 메일이 발송됩니다.

{% tabs migration-status %}

{% tab migration-status Export Completed %}

&amp;#8259; **Export Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-30.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Import Completed %}

&amp;#8259; **Import Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-31.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% tab migration-status Migration Completed %}

&amp;#8259; **Migration Completed**  
{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-32.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

{% endtab %}

{% endtabs %}

{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;
이 단계까지 완료되면 현재 상태는 **Source DB**와 **Target DB**간의 **Replication**이 완료된 상태이므로 이때 서비스 점검을 시작하고 아래쪽의 마이그레이션 **완료** 버튼을 클릭해서 최종 완료를 확인한 후에 서비스 점검을 종료하면 되겠습니다. 
&quot; %}

## 마이그레이션 완료
마이그레이션 작업이 완료되면 아래와 같이 콘솔화면에서 [**완료**] 버튼이 활성화 됩니다. 즉, 현재는 [**Replication**] 작업이 완료된 상태로 [**Source DB**]와 [**Target DB**]가 복제 동기화 되어 있고, [**Target DB**]는 [**쓰기 불가**] 상태입니다.  

그러므로 [**완료**] 버튼 클릭해야 모든 작업이 완료되고, [**Target DB**]가 [**쓰기 가능**] 상태로 변경됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-33.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

- [**완료**] 버튼 클릭하면 아래와 같이 안내 메시지가 출력되고 [**확인**] 버튼을 클릭하면 완료됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-34.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### 최종 완료
최종 완료가 되면 아래와 같이 [**Migration Status**] 상태가 **완료**상태로 변경되고 [**Migration 종료 일시**]로 기록됩니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-35.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## Target DB 데이터 확인
마이그레이션이 모두 완료되었으므로 [**Source DB**]의 데이터가 [**Target DB**]로 모두 이상 없이 마이그레이션 되었는지 [**Target DB**]에 접속해서 직접 확인해보겠습니다.  
확인해보는 방법은 [**Target DB**]와 동일한 [**Subnet**]에 테스터 서버를 생성하고,  [**Target DB**]에 접속해서 [**Database**], [**Table**], [**Procedure**] 등이 정상적으로 존재하는지 살펴보는 것인데, 아래 스샷처럼 모두 이상이 없는 것을 확인할 수 있습니다.

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-40.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


## 오류 상황
지금부터는 마이그레이션 진행 중에 나타날 수 있는 오류 메시지 관련해서 정리해보고, 해결 방법을 알아보겠습니다.

### 방화벽 설정 오류  
[**Source DB**]의 방화벽 Inbound 설정과 [**Target DB**]의 ACG Outbound 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [접근 권한 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#ACG) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 와 Target DB 서버 통신이 되지 않습니다. &lt;br/&gt;Source DB Inbound 와 Target DB Outbound ACG 를 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-36.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### Endpoint DB User 설정 오류  
[**Endpoint 설정**]에서 [**DB User**] 또는 [**DB Password**] 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [Endpoint 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#Endpoint) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB 에 접속이 되지 않습니다.&lt;br /&gt;DB ACL 을 점검해 주세요.&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-37.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}

### DEFINER 계정 생성 오류
[**Source DB**]에 [**Procedure**], [**Function**], [**VIEW**] 등이 존재하고, 이때 사용된 DB User 즉, [**DEFINER**] 계정이 [**Target DB**]에 존재하지 않았을 경우 나타나는 메시지 입니다. [DEFINER 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#DEFINER) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;Source DB에 생성된 Definer 계정이 Target DB 에 존재하지 않습니다.&lt;br /&gt;Definer 에 사용된 계정은 먼저 생성후 진행해 주세요.&lt;br /&gt;필요 Definer 계정 : abcd2@%&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-38.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}


### 바이너리 로그 설정 오류
Source DB의 바이너리 로그 설정 중에서, [server_id], [log_bin] 관련 설정이 올바르지 않을 경우 나타나는 메시지 입니다. [바이너리 로그 설정 &lt;i class=&quot;fa-solid fa-arrow-up-from-bracket&quot;&gt;&lt;/i&gt;](#log_bin) 내용을 다시 확인해주세요.
{% include callout-v2.html type=&quot;warning&quot; level=&quot;2&quot; content=&quot;마이그레이션을 위해서는 Source DB Config 설정이 필요합니다.&lt;br /&gt;추가 필요 설정 : log_bin&quot;%}

{% include image.html file=&quot;database/migration/ncloud-database-db-migration-from-mysql57-to-mysql57-guide-39.png&quot; width=&quot;485&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud(네이버 클라우드) Database Migration 서비스를 이용해 MySQL 5.7에서 클라우드 환경 MySQL 5.7로 마이그레이션하는 방법&quot; caption=&quot;&quot; %}



## 참고 URL
1. Database Migration Service 개요
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/ko/dms-overview&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/ko/dms-overview&lt;/a&gt;

2. Source DB 및 Target DB 접속 설정
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/dms-connect&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/dms-connect&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}  
</description>
            <pubDate>Mon, 23 Oct 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mysql57-to-mysql57-guide.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/database/ncloud-database-db-migration-from-mysql57-to-mysql57-guide.html</guid>
            
            <category>database</category>
            
            <category>vpc</category>
            
            <category>MySQL</category>
            
            
        </item>
        
        <item>
            <title>설치형 PostgreSQL DB 설치, 접속 가이드 | Rocky Linux</title>
            <description>## 개요
PostgreSQL은 설치 후에 DB에 접속할 때 MySQL등 다른 DB와 달리 [**OS와 PostgreSQL 양쪽에 동일한 계정을 생성**]하거나 
[**인증관련 환경설정 파일을 수정**]해야 접속할 수 있는데 이 두가지 방법을 [**Rocky Linux**]에서 적용하는 과정을 정리해보겠습니다.

## 테스트 환경
- Rocky Linux 8.8
- PostgreSQL 13.12


## 설치
기본 배포 버전으로 테스트할 수도 있지만, 여기서는 **PostgreSQL 13** 최신 버전을 설치해보겠습니다.

### 리포지토리 버전 확인
우선 Rocky Linux에서 지원하는 기본 버전들을 확인해보면 아래와 같이 PostgreSQL [**9.6**], [**10**], [**12**], [**13**], [**15**] 인 것을 확인할 수 있습니다.

``` bash
~# dnf module list postgresql
```

{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-02.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

### 기본 버전 비활성화
**PostgreSQL 13** 최신 버전을 사용하기 위해 기본 버전들은 모두 비활성화합니다. 비활성화 처리 후 리스트를 다시 조회해보면 [**disabled**]를 뜻하는 [**X**]로 변경된 것을 확인할 수 있습니다.

``` bash
~# dnf -qy module disable postgresql
~# dnf module list postgresql
```

{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-03.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}


### 리포지토리 설치
[**PostgreSQL 13**] 설치 정보가 담겨 있는 리포지토리 RPM을 설치합니다.

``` bash
~# dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-01.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}



### PostgreSQL 설치
[**PostgreSQL 13**]을 설치합니다.

``` bash
~# dnf install -y postgresql13-server
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-04.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

### 기본 DB 생성
[**initdb**] 명령으로 기본 DB를 생성하고 올바르게 생성되었는지 로그를 확인해보겠습니다.

``` bash
~# cd /usr/pgsql-13/bin/
~# postgresql-13-setup initdb
~# cat /var/lib/pgsql/13/initdb.log
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-05.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

### PostgreSQL 시작
``` bash
~# systemctl enable postgresql-13
~# systemctl start postgresql-13
~# systemctl status postgresql-13
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-06.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

## DB 접속
기본 마스터 계정인 [**postgres**]로 [**PostgreSQL**]에 접속합니다.

``` bash
~# su postgres
bash$ psql
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-07.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}


### 유저 생성
테스트용 계정 [testuser]를 생성하고 [**\du**] 명령으로 생성된 유저를 확인합니다.

``` sql
postgres=# create user testuser password &apos;test123$&apos; superuser;
postgres=# \du 
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-08.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

### DB 생성 및 소유자 지정
테스트용 DB를 생성하고 소유자를 지정한 후에 [**\l**] 명령으로 생성된 DB를 확인합니다.  

``` sql
postgres=# create database testdb owner testuser;
postgres=# \l
postgres=# \q
bash$
``` 
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-09.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}


### 접속 시도 - 인증 오류
위에서 생성한 계정으로 접속을 시도해보면, 아래와 같이 인증 오류가 발생합니다.  
다음 단계에서는 이 인증 오류를 **해결하는 방법 2가지**를 확인해보겠습니다.

``` bash
~# psql -U testuser -d testdb
psql: error: FATAl: Peer authentication failed for user &quot;testuser&quot;
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-10.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}


## 인증 오류 해결
인증 문제를 해결하고 [**PostgreSQL**]에 접속하는 방법은 크게 2가지가 있는데 한가지씩 확인해보겠습니다.


### 방법1 - 동일한 계정 생성
우선, 처음에 DB 생성 후에 추가했던 [**PostgreSQL**] 유저 계정과 동일한 계정을 OS 사용자에도 추가하는 방법입니다.  

아래와 같이 DB 유저와 동일한 [testuser] 계정을 생성하겠습니다.
``` bash
~# adduser testuser
~# passwd testuser
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-11.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

- **DB 접속**  
새로 생성한 [**testuser**] 계정으로 전환한 후에 접속을 해보면 문제 없이 접속되는 것을 확인할 수 있습니다.

``` bash
~# su testuser
~$ psql -U testuser -d testdb
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-12.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}


### 방법2 - 인증 설정 파일 수정
다음으로 인증 관련 설정 파일인 [**pg_hba.conf**] 파일을 수정해서 접속하는 방법을 확인해보겠습니다.  

[**pg_hba.conf**] 파일을 열어보면 아래와 같이 DB 접근 설정 항목들이 있는데 [**local**]과 IPv4용 [**host**]의 METHOD 항목을 보시면 각각 [**peer**]과 [**scram-sha-256**]으로 설정되어 있는 것을 확인할 수 있습니다.  

{% include callout-v2.html type=&quot;info&quot; level=&quot;2&quot; content=&quot;여기서 [**peer**]는 운영 체제에서 클라이언트의 운영 체제 사용자 이름과 요청한 데이터베이스 사용자 이름이 일치하는지 확인하는 옵션입니다.&quot; %}

이 항목을 [**scram-sha-256**] 또는 [**md5**]로 수정합니다.

``` bash
~# vim /var/lib/pgsql/13/data/pg_hba.conf
```

- 수정 전
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-13.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

- 수정 후
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-14.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}

- **DB 재시작 후 접속**  
설정 파일을 수정했으면 [**PostgreSQL**]을 재시작하고 다시 접속해봅니다.  
이번에는 문제 없이 DB 유저 생성 시 입력했던 패스워드를 입력하고 접속 가능한 것을 확인할 수 있습니다.

``` bash
~# systemctl restart postgresql-13
~# psql -U testuser -d testdb
```
{% include image.html file=&quot;database/ncloud-database-postgresql-install-connect-guide-rocky-linux-15.png&quot; width=&quot;840&quot; alt=&quot;Ncloud(네이버 클라우드) VPC환경에서 설치형 PostgreSQL DB를 설치하고, 접속하는 방법&quot; caption=&quot;&quot; %}


## 기본 배포 버전 설치
[**PostgreSQL 13**] 최신 버전이 아닌 기본 배포 버전을 설치하려면 아래와 같은 방법으로 설치를 하면 됩니다.  
나머지 인증 방법은 위에서 설명한 내용과 동일합니다.

``` bash
~# dnf install -y postgresql-server
~# cd /usr/bin/
~# postgresql-setup --initdb
~# systemctl enable postgresql
~# systemctl start postgresql
~# systemctl status postgresql
```

### OS별 배포 버전
2023년 9월 13일 기준 Red Hat family OS별로 설치되는 배포 버전은 다음과 같습니다.

- RHEL / Rocky Linux 9 : 15, 13
- RHEL / Rocky Linux / OL 8	: 15, 13, 12, 10 and 9.6 via modules
- RHEL / CentOS / SL / OL 7	: 9.2
- RHEL / CentOS / SL / OL 6	: 8.4
- Fedora 37	: 14
- Fedora 36	: 14



## pg_hba.conf 파일 Method 옵션
[**pg_hba.conf**] 설정 파일의 Method 옵션 리스트는 아래와 같습니다.

- **trust**: 무조건 접속을 허용합니다. 이 방법을 사용하면 PostgreSQL 데이터베이스 서버에 연결할 수 있는 모든 사람이 암호나 다른 인증 없이 원하는 PostgreSQL 사용자로 로그인할 수 있습니다. 

- **reject**: 무조건 연결을 거부합니다. 이것은 그룹에서 특정 호스트 를 &quot; 필터링 &quot;reject 하는 데 유용합니다. 예를 들어 한 라인은 특정 호스트의 연결을 차단할 수 있고 나중 라인은 특정 네트워크의 나머지 호스트가 연결할 수 있도록 합니다.

- **scram-sha-256**: SCRAM-SHA-256 인증을 수행해 사용자의 암호를 확인합니다. 

- **md5**: SCRAM-SHA-256 또는 MD5 인증을 수행해 사용자의 암호를 확인합니다. 

- **password**: 클라이언트가 인증을 위해 암호화되지 않은 암호를 제공하도록 요구합니다. 암호는 네트워크를 통해 일반 텍스트로 전송되기 때문에 신뢰할 수 없는 네트워크에서는 사용해서는 안 됩니다. 

- **gss**: GSSAPI를 사용해 사용자를 인증합니다. 이것은 TCP/IP 연결에만 사용할 수 있습니다. GSSAPI 암호화와 함께 사용할 수 있습니다.

- **sspi**: SSPI를 사용해 사용자를 인증합니다. 이것은 Windows에서만 사용할 수 있습니다. 

- **ident**: 클라이언트의 ident 서버에 연결하여 클라이언트의 운영 체제 사용자 이름을 얻고 요청한 데이터베이스 사용자 이름과 일치하는지 확인합니다. ID 인증은 TCP/IP 연결에서만 사용할 수 있습니다. 로컬 연결에 대해 지정된 경우 피어 인증이 대신 사용됩니다. 

- **peer**: 운영 체제에서 클라이언트의 운영 체제 사용자 이름을 가져와서 요청한 데이터베이스 사용자 이름과 일치하는지 확인합니다. 이것은 로컬 연결에만 사용할 수 있습니다. 

- **lda**: LDAP 서버를 사용해 인증 합니다. 

- **radius**: RADIUS 서버를 사용해 인증합니다. 

- **cert**: SSL 클라이언트 인증서를 사용해 인증합니다. 

- **pam**: 운영 체제에서 제공하는 PAM(Pluggable Authentication Modules) 서비스를 사용해 인증합니다. 

- **bsd**: 운영 체제에서 제공하는 BSD 인증 서비스를 사용해 인증합니다. 



## 참고 URL
1. PostgreSQL OS별 다운로드 안내
	- &lt;a href=&quot;https://www.postgresql.org/download/linux/&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://www.postgresql.org/download/linux/&lt;/a&gt;

2. PostgreSQL pg_hba.conf 파일 옵션 안내
	- &lt;a href=&quot;https://www.postgresql.org/docs/current/auth-pg-hba-conf.html&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://www.postgresql.org/docs/current/auth-pg-hba-conf.html&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}  
</description>
            <pubDate>Wed, 13 Sep 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/database/ncloud-database-postgresql-install-connect-guide-rocky-linux.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/database/ncloud-database-postgresql-install-connect-guide-rocky-linux.html</guid>
            
            <category>database</category>
            
            <category>vpc</category>
            
            <category>postgresql</category>
            
            
        </item>
        
        <item>
            <title>Ncloud VPC 환경에서 무료 서버(Micro Type) 이용하는 방법</title>
            <description>## 개요 
Ncloud (네이버 클라우드)는 체험 및 테스트 용도로 **최초 결제 수단 등록 월부터 1년간 무료**로 사용할 수 있는 Micro 타입 서버를 제공하고 있습니다. 전에는 Classic 환경에서만 이용할 수 있었는데, 최근 업데이트 이후 VPC 환경에서도 이용할 수 있게 되었기에, VPC 환경에서 무료 서버인 Micro 타입 서버를 생성하는 과정을 정리해보겠습니다.

## Micro 타입 서버 특징
- 스펙: vCPU 1개, 메모리 1GB
- `계정당 1대`만 이용 가능
- 체험용으로 가용성 및 성능 보장 불가
- 거주지 국가가 한국인 경우만 제공
- `신규 가입 후 최초 결제 수단 등록 월부터 1년간 무료` 제공, 1년이 지나면 **월요금제**로 과금
- 최초 결제 수단 등록 월은 포털 마이페이지 &gt; 결제수단 관리에서 확인
- Network Interface는 1개만 이용 가능
- 3세대(g3) 서버로 **KVM** 하이퍼바이저 기반의 서버만 제공
- 기본 스토리지는 **10 GB까지만 무료**이며, 용량을 늘리거나 추가하는 스토리지의 경우 유료 과금


## 서버 생성
[**VPC**] 환경에서 서버(Server)를 생성하려면 사전에 [**VPC**]와 [**Subnet**]이 생성되어 있어야 하는데, 혹시 처음 [**VPC**] 환경에 접속하셔서 [**VPC**]와 [**Subnet**]이 존재하지 않는 경우는 아래 문서를 보고 미리 생성하고 오셔야 합니다.

{% include callout-v2.html type=&quot;info&quot; level=&quot;2&quot; content=&quot;
&lt;a href=&apos;/compute/ncloud_compute_server_vpc_create.html&apos; target=&apos;_blank&apos; style=&apos;word-break:break-all;&apos;&gt;VPC 환경에서 서버 생성하는 방법 (VPC, Subnet 생성 포함)&lt;/a&gt;
&quot; %}

## Server 서비스 위치
[**Server**] 서비스는 [**Console**] - [**Services**] - [**Compute**]에 위치해 있습니다.

{% include image.html file=&quot;compute/ncloud-compute-vpc-server-create-guide-01.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud VPC 환경에서 서버를 생성하는 방법&quot; caption=&quot;&quot; %}

- [**Server**] - [**Server**]에서 [**서버 생성**] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/ncloud-compute-vpc-server-create-guide-02.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud VPC 환경에서 서버를 생성하는 방법&quot; caption=&quot;&quot; %}

## 서버 생성 콘솔 선택
Ncloud 서버 생성 콘솔화면은 신규 기능이 업데이트 되면서 2가지를 선택할 수 있습니다. Micro 타입 서버는 **KVM** 하이퍼바이저 기반의 서버이므로  [**신규 콘솔 화면**]으로 진행하겠습니다.

- 기존 콘솔 화면: **XEN, RHV** 하이퍼바이저 기반의 서버(g1,g2)를 생성할 수 있습니다.
- 신규 콘솔 화면: **XEN, RHV** 하이퍼바이저 기반의 서버(g1,g2)뿐만 아니라 **KVM** 기반 및 다양한 성능을 제공하는 기본 스토리지로 서버(**g3**)를 생성할 수 있습니다.

{% include image.html file=&quot;compute/ncloud-compute-vpc-server-create-guide-03.png&quot; width=&quot;685&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud VPC 환경에서 서버를 생성하는 방법&quot; caption=&quot;&quot; %}

## 서버 이미지 선택
Micro 타입 서버를 생성하려면 하이퍼바이저 기준으로 [**KVM**] 서버 이미지를 선택하면 됩니다. 현재 Ncloud에서 제공되는 [**KVM**] 서버 이미지는 아래와 같이 [**Rocky Linux 8.8**], [**Ubuntu 20.04**], [**CentOS 7.8**] 이렇게 3가지 입니다. 여기서는 Ubuntu 20.04로 생성해보겠습니다.

{% include image.html file=&quot;compute/ncloud-compute-micro-type-server-create-vpc-guide-01.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud (네이버 클라우드) VPC 환경에서 무료 서버(Micro Type) 이용하는 방법&quot; caption=&quot;&quot; %}

## 서버 설정
서버 설정 단계에서는 [**VPC**]와 [**Subnet**]을 선택하고  [**서버 스펙**]과 [**요금제**], [**Network Interface**], [**공인 IP 할당 여부**] 등을 선택하게 됩니다. `서버는 1년간 무료이지만, 공인 IP를 할당하게 되면 공인 IP 비용이 청구됩니다.`

{% include image.html file=&quot;compute/ncloud-compute-micro-type-server-create-vpc-guide-02.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud (네이버 클라우드) VPC 환경에서 무료 서버(Micro Type) 이용하는 방법&quot; caption=&quot;&quot; %}

## 스토리지 설정
KVM 하이퍼바이저 기반인 Micro 타입서버는 기본 스토리지 10GB까지만 무료로 제공되며, 용량을 늘릴 경우 비용이 발생합니다.

{% include image.html file=&quot;compute/ncloud-compute-micro-type-server-create-vpc-guide-03.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud (네이버 클라우드) VPC 환경에서 무료 서버(Micro Type) 이용하는 방법&quot; caption=&quot;&quot; %}

## 인증키 설정
인증키 이름을 입력하고, [**인증키 생성 및 저장**] 버튼을 클릭해서 인증키를 로컬 PC에 다운로드 받아서 안전한 곳에 보관해야 합니다. 기존에 사용하고 있던 인증키가 있을 경우에는 [**보유하고 있는 인증키 이용**]을 선택하면 됩니다.

{% include warning.html title=&quot;인증키&quot; content=&quot;인증키는 해당 서버의 **관리자 비밀번호**를 확인하는데 사용되므로 **안전한 곳에 잘 보관**해야 합니다.&quot; %}

{% include image.html file=&quot;compute/ncloud-compute-vpc-server-create-guide-20.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-top-bottom&quot; alt=&quot;Ncloud VPC 환경에서 서버를 생성하는 방법&quot; caption=&quot;&quot; %}

## 네트워크 접근 설정
네트워크 접근은 [**ACG**]로 설정하게 되는데, `ACG(Access Control Group)는 서버 간 네트워크 접근 제어 및 관리를 할 수 있는 IP/Port 기반 필터링 방화벽 서비스`로, 서버에 별도의 복잡한 방화벽 구축없이 간단하게 서버에 대한 네트워크 접근 제어를 할 수 있습니다.  
[**VPC**]를 생성하면 자동으로 생성되는 **기본 ACG**를 선택하거나 별도로 생성한 ACG가 있을 경우 해당 ACG를 선택하면 됩니다. **적용할 ACG는 최대 3개**까지 선택할 수 있습니다.

{% include image.html file=&quot;compute/ncloud-compute-micro-type-server-create-vpc-guide-04.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud (네이버 클라우드) VPC 환경에서 무료 서버(Micro Type) 이용하는 방법&quot; caption=&quot;&quot; %}

## 서버 생성 완료
모든 단계를 마치고 나면 아래와 같이 서버가 생성된 것을 확인할 수 있습니다.

{% include image.html file=&quot;compute/ncloud-compute-micro-type-server-create-vpc-guide-05.png&quot; width=&quot;845&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud (네이버 클라우드) VPC 환경에서 무료 서버(Micro Type) 이용하는 방법&quot; caption=&quot;&quot; %}

## 서버 접속
생성된 서버에 접속해서 vCPU와 Memory 상태를 확인해보면 다음과 같습니다.

``` bash
~# grep -c processor /proc/cpuinfo
~# free
```

{% include image.html file=&quot;compute/ncloud-compute-micro-type-server-create-vpc-guide-06.png&quot; width=&quot;840&quot; sub-class=&quot;docimage-no-bottom&quot; alt=&quot;Ncloud (네이버 클라우드) VPC 환경에서 무료 서버(Micro Type) 이용하는 방법&quot; caption=&quot;&quot; %}


## 참고 URL
1.  Ncloud 서버 접속 가이드
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/server-access-vpc&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/server-access-vpc&lt;/a&gt;

2.  Ncloud 서버 인증키 변경하는 방법
	- &lt;a href=&quot;/compute/ncloud-compute-server-change-authentication-key.html&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://docs.3rdeyesys.com/compute/ncloud-compute-server-change-authentication-key.html&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}
</description>
            <pubDate>Mon, 11 Sep 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/compute/ncloud-compute-micro-type-server-create-vpc.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/compute/ncloud-compute-micro-type-server-create-vpc.html</guid>
            
            <category>linux</category>
            
            <category>vpc</category>
            
            
        </item>
        
        <item>
            <title>Classic 환경에서 AutoScaling 설정하는 방법</title>
            <description>## 개요
AutoScaling 서비스는 미리 등록한 설정에 따라 서버 수를 자동으로 증가 또는 감소시켜 안정적인 서비스를 유지하면서 비용을 절감할 수 있도록 해주는 서비스입니다.  
여기서는 네이버 클라우드 Classic 환경에서 AutoScaling 설정하는 방법을 정리해보겠습니다.

{% include image.html file=&quot;compute/autoscaling/ncloud_server_autoscaling_guide_classic_30.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}

## 기본 설정
Auto Scaling 설정은 우선 [Auto Scaling] - [Launch Configuration]에서  
[Launch Configuration 생성] 버튼을 클릭하는 것으로 시작합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_01.jpg&quot; width=&quot;700&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 서버 이미지 선택
서버 이미지는 네이버 클라우드에서 제공하는 기본 이미지를 선택할 수도 있고, 기존 서버로 만들어 둔 [내 서버 이미지]를 사용할 수도 있습니다. 여기서는 기본 이미지를 사용하는 것으로 하겠습니다.

{% include callout_v2.html type=&quot;info&quot; level=&quot;2&quot; content=&quot;현재 Classic 환경 AutoScaling에서 지원하는 Linux 서버 이미지 버전은 다음과 같습니다. &lt;br /&gt;
&amp;#8259; CentOS 7.3, 7.8 &lt;br /&gt;
&amp;#8259; Ubuntu 18.04
&quot; %}

{% include image.html file=&quot;compute/autoscaling/ncloud_server_autoscaling_guide_classic_02.png&quot; width=&quot;845&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 서버 설정
스토리지 종류와 서버 타입 등을 선택합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_03.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 이름 설정
Launch Configuration의 이름을 입력합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_04.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 인증키 설정
인증키는 기존에 보유하고 있던 인증키를 이용해도 되고, 새로운 인증키를 설정해도 됩니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_05.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 네트워크 접근 설정 (ACG)
ACG 설정도 기존에 보유하고 있던 ACG 중에서 선택해도 되고, 새로운 ACG를 생성해도 됩니다. 여기서는 새로운 ACG를 생성하는 방법으로 진행하겠습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_06.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


ACG 이름을 입력하고, [myIp]를 클릭, 허용할 포트를 입력한 후 [추가] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_07.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 최종 확인
지금까지 설정한 정보를 마지막으로 확인 한 후에 이상이 없으면 [Launch Configuration 생성] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_08.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}



## Group 생성
다음으로 Auto Scaling Group을 생성합니다. [Auto Scaling] - [Auto Scaling Group]에서 [Auto Scaling Group 생성] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_09.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### Launch Configuration 선택
위에서 생성했던 Launch Configuration을 선택합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_10.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 그룹 설정
여기서는 생성될 서버들의 이름과 최소, 최대 개수 등을 설정합니다.  
Auto Scaling Group당 최대 30대의 서버를 생성할 수 있고, Zone, NAT Gateway 설정은 생성 후 변경할 수 없으며, 변경이 필요하면 새로 생성하여 사용해야 합니다.  

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_11.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


- **서버이름 Prefix** : 최대7자까지 지정할 수 있고, 나머지 이름의 뒷부분은 영문,숫자의 조합으로 무작위로 자동 생성됩니다.
- **서버 용량** : 최소, 최대, 기대 용량은 서버 대수를 의미하며 각각 **0~30까지 입력 가능**합니다.
- **쿨다운 기본값** : 새로운 서버가 생성되었다고 해도, init script 실행이나 업데이트 설치 등의 이유로 실제 서비스를 수행할 수 있을 정도로 준비되기까지는 시간이 소요될 수 있습니다. 
  즉, 쿨다운(Cooldown) 시간이란 실제 Scaling이 수행 중이거나 수행 완료된 이후에 모니터링 이벤트 알람이 발생하더라도 반응하지 않고 무시하도록 설정한 기간입니다.  
  **값을 입력하지 않으면 기본값인 300초가 적용됩니다**.

- **헬스체크 보류기간** : 서버 인스턴스가 생성되어 상태가 ‘운영 중’으로 바뀌었더라도, 서버의 업데이트 설치 등 작업에 의해서 헬스 체크에 정상 응답하지 못하는 경우가 생길 수 있습니다. 
  이런 경우 헬스 체크 보류 기간을 지정하면 해당 기간 동안에는 헬스 체크에 실패하더라도 서버에 이상이 있다고 판단하지 않습니다.  
  **값을 입력하지 않으면 기본값인 300초가 적용됩니다**.

&lt;br /&gt;

### 정책/일정 설정
정책과 일정을 여기서 바로 설정할 수도 있고 나중에 설정할 수도 있습니다. 여기서는 [나중에 설정]으로 선택하고 아래쪽에서 다시 살펴보겠습니다. 

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_12.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 통보 설정
통보 설정을 여기서 바로 설정할 수도 있고 나중에 설정할 수도 있습니다. 여기서는 [나중에 설정]으로 선택하고 아래쪽에서 다시 살펴보겠습니다. 

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_13.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 최종확인
생성된 Group 설정값들을 마지막으로 확인하고 [Auto Scaling Group 생성] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_14.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


## 서버 생성 확인
위에서 Auto Scaling Group을 생성하면 아래와 같이 즉시 서버가 생성되는 것을 확인할 수 있습니다. 처음에는 [기대용량]에 입력한 개수만큼 서버가 생성됩니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_15.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}



## 설정 관리 - 정책
위에서 나중에 설정하기로 하고 넘어갔던 Auto Scaling Group의 정책, 일정, 이력, 통보 설정 등을 확인해보겠습니다.  
[Auto Scaling Group]에서 해당 그룹을 선택하고, [설정 및 관리] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_16.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


### 정책 설정
먼저 [정책] 탭을 선택하고, [생성] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_17.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


우선 서버를 증가시킬 정책으로 increase라는 이름을 입력하고, 증가시킬 서버 개수를 입력 후 [추가] 옵션을 선택하고 [생성] 버튼을 클릭합니다. 

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_18.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


다음으로 서버를 감소시킬 정책으로 decrease라는 이름을 입력하고, 감소시킬 서버 개수를 입력 후 [반납] 옵션을 선택하고 [생성] 버튼을 클릭합니다. 

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_19.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


서버 증가, 감소를 위한 정책 2가지가 생성된 것을 확인할 수 있습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_20.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


## 그룹 이벤트 설정
위에서 설정한 정책이 언제 실행되게할 것인가 즉, 서버에 어떤 이벤트가 발생했을 때 정책을 실행할 것인가를 결정하는 그룹 이벤트를 설정합니다.  
그룹 이벤트 설정은 [Classic] - [Monitoring] - [Group Event Setting]에서 할 수 있으며, 위에서 만든 Auto Scaling 그룹을 선택하고 [그룹 이벤트 설정] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_21.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


그룹 이벤트 설정 화면에 들어가면 위에서 만든 increase, decrease 2가지 정책이 리스트에 나타나는 것을 확인할 수 있습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_22.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


정책이 발동되게 하는 이벤트는 여러가지가 있는데, 가장 많이 선택하는 것이 CPU 사용률입니다.  
여기서는 **CPU 사용률(used)이 60% 이상일 때 increase 정책**, **CPU 사용률(used)이 30% 이하일 때 decrease 정책**이 실행되도록 이벤트를 추가했습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_23.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


## 설정 관리 - 일정
위에서는 서버에 설정한 이벤트가 발생했을 때 정책이 발동되도록 했지만, 그 외에도 특정한 시간대에 사용자가 몰리는 피크 타임이 일정하다면 해당 시간 전후로 서버를 늘리거나 감소시키는 방법도 가능합니다.  
여기 [일정] 탭에서 해당 내용을 설정해두면 피크 타임에 미리 서버를 증가시켜서 좀 더 안정적인 서비스가 가능하게 설정할 수 있습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_24.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


## 설정 관리 - 이력
[이력] 탭에서는 서버가 생성되고 반납된 기록을 확인할 수 있습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_25.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


## 설정 관리 - 통보
[통보] 탭에서는 서버가 생성되거나 반납될 때 지정한 담당자에게 SMS나 Email로 통보하도록 설정할 수 있습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_26.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}

## 설정 관리 - 서버
[서버] 탭은 현재 작동중인 서버 리스트를 확인할 수 있습니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_27.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


## 중지 - 서버삭제
마지막으로, Auto Scaling을 중지하고, 작동중인 서버를 한번에 모두 삭제하는 방법을 확인해보겠습니다.  

[Auto Scaling] - [Auto Scaling Group]에서 해당 그룹을 선택하고 상단에 있는 [수정] 버튼을 클릭합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_28.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud(네이버 클라우드) Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}


여기서 **[최소 용량], [최대 용량], [기대 용량] 항목의 값을 모두 0으로 설정**하면, 현재 작동중인 서버가 모두 반납되고, 더 이상 서버가 추가로 생성되지 않아서 Auto Scaling이 중지되게 됩니다.  
사실 [최소 용량], [기대 용량] 2가지 항목만 0으로 설정해도 되지만, 혹시나 모르는 상황을 위해서 깔끔하게 3가지 항목 모두 0으로 설정합니다.

{% include image.html file=&quot;compute/autoscaling/ncp_server_autoscaling_guide_classic_29.jpg&quot; width=&quot;770&quot; alt=&quot;Ncloud Classic 환경에서 AutoScaling 설정하는 방법&quot; caption=&quot;&quot; %}

## 서비스 제한사항
Auto Scaling 설정과 서버 스펙 등에 대한 제한 사항을 정리해보겠습니다.

### 스펙 및 서비스 환경 제한 사항
- 총 디스크 사이즈 150GB 이하 서버만 가능
- Windows OS는 Windows 2016. 2019만 지원
- 내 서버 이미지의 경우, 원본 서버의 부팅 디스크 크기가 50GB인 경우만 지원(100GB 디스크에 대해서는 추후 지원 예정)

### 설정 제한 사항
- 고객별 생성 가능한 Auto Scaling Group 최대 수: 10
- 고객별 생성 가능한 Launch Configuration 최대 수: 100
- Auto Scaling Group당 생성 가능한 스케줄(Scheduled Action) 최대 수: 100
- Auto Scaling Group당 생성 가능한 Scaling Policy 최대 수: 10
- Auto Scaling Group당 생성 가능한 최대 서버 수: 30대
- Auto Scaling Group당 연결 가능한 Load Balancer 최대 수 : 10


## 용어 정리
Auto Scaling에서 사용되는 주요 용어들을 정리해보겠습니다.

| 용어 | | 설명|
| :----: | :----: | :---- |
| Scale-in / Scale-out | | Auto Scaling Group을 생성하여 고객이 설정한 Policy에 따라 사용하고 있는 가상 서버의 자동 확장(Scale-out) 및 자동 축소(Scale-in)하도록 제공합니다. |
| Auto Scaling Group | | 여러 개의 서버 인스턴스들을 Auto Scaling Group 이라는 하나의 그룹으로 묶어 놓게 됩니다. |
| Launch Configuration | | Auto Scaling Group에서 가상 서버를 시작 구성하는 데 사용하는 템플릿입니다. Auto Scaling Group을 생성할 때는 Launch Configuration을 지정해야 합니다. |
| Auto Scaling Group의 최소 용량/최대 용량 | | Auto Scaling Group의 최소/최대 서버 수를 말합니다. 최소 서버 수의 경우, 항상 이 값과 같거나 이 값보다 더 큰 서버 수가 유지됩니다. 서버를 한 대도 보유하지 않을 수 있게 하려면 0으로 설정합니다. |
| 기대 용량 (Desired Capacity) | | 서버의 수는 기대 용량값에 따라서 조정됩니다. 이 값은 최소 용량 이상, 최대 용량 이하여야 합니다. 이 값이 지정되어 있지 않으면 초기에 최소 용량만큼 서버를 생성합니다. |
| 쿨다운 기본값(초) (Default Cooldown) | | Default Cooldown(초) 새로운 서버가 생성되었다고 해도, Init-Script 실행이나 업데이트 설치 등의 이유로 실제 서비스를 수행할 수 있을 정도로 준비되기까지는 시간이 소요될 수 있습니다. 쿨다운(Cooldown) 시간이란 실제 Scaling이 수행 중이거나 수행 완료된 이후에 모니터링 이벤트 알람이 발생하더라도 무시하도록 설정한 기간입니다. |
| 헬스체크 | | Auto Scaling Group의 가상 서버에 주기적인 상태 확인을 수행하여 상태가 비정상인 가상 서버를 식별하도록 Health Check를 합니다. |
| 헬스체크 보류 기간 | |	서버가 생성되어 ‘운영중’으로 변경되었더라도 서버의 업데이트 설치 등 작업에 의해서 헬스 체크에 정상 응답하지 못하는 경우가 생길 수 있습니다. 이런 경우 헬스 체크 보류기간을 지정하면 해당 기간 동안에는 헬스 체크에 실패하더라도 서버 헬스에 이상이 있다고 판단하지 않습니다. |
| 헬스체크 유형 | | 서버와 Load Balancer 둘 중에 선택할 수 있습니다. Auto Scaling Group 설정에서 Load Balancer 이름을 지정한 경우에는 헬스 체크 유형 역시 Load Balancer로 설정합니다. 이런 경우 Auto Scaling은 Load Balancer 헬스 체크 방식과 기준에 따라 서버의 상태를 판단합니다. |
| 반납 정책 | | Auto Scaling 과정에서 추가된 서버에 대한 Scale-in 작업에 대해, 고객이 API 질의 형식으로먼저 반납할 서버를 지정할 수 있습니다. 기본 설정은 먼저 생성된 서버부터 반납합니다. |
| Policy | | Auto Scaling이 일어나는 방식을 정의하고 있는데, 이를 ‘Policy’로 정의하고 있습니다. Auto Scale-out 이 발생할 때, 몇 대의 가상 서버를 늘릴 것인지, 반대로 Scale-in이 발생할 때 몇 대의 가상서버를 줄일 것인지를 정의합니다. 대수로 정의할 수 도 있고, %로 정의할 수도 있습니다. |

## 참고 URL
1.  Ncloud Auto Scaling 가이드
	- &lt;a href=&quot;https://guide.ncloud-docs.com/docs/compute-autoscaling-autoscalingoverview&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://guide.ncloud-docs.com/docs/compute-autoscaling-autoscalingoverview&lt;/a&gt;

2. VPC 환경에서 Auto Scaling 설정하기
    - &lt;a href=&quot;/compute/ncloud-compute-autoscaling-vpc-guide.html&quot; target=&quot;_blank&quot; style=&quot;word-break:break-all;&quot;&gt;https://docs.3rdeyesys.com/compute/ncloud-compute-autoscaling-vpc-guide.html&lt;/a&gt;


## 문서 업데이트 내역
{% include doc-history.html width=&quot;50%&quot; %}  	</description>
            <pubDate>Wed, 06 Sep 2023 00:00:00 +0900</pubDate>
            <link>https://docs.3rdeyesys.com/compute/ncloud_compute_autoscaling_classic_guide.html</link>
            <guid isPermaLink="true">https://docs.3rdeyesys.com/compute/ncloud_compute_autoscaling_classic_guide.html</guid>
            
            <category>autoscaling</category>
            
            <category>classic</category>
            
            
        </item>
        
    </channel>
</rss>
